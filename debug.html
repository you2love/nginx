<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nginx æ—¥å¿—è°ƒè¯• - é—®é¢˜æ’æŸ¥æŒ‡å—</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f5f5f5;
        }
        .header {
            background: linear-gradient(135deg, #009639 0%, #007a2e 100%);
            color: white;
            padding: 20px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .header .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        .header h1 {
            font-size: 28px;
            margin-bottom: 5px;
        }
        .header .tagline {
            opacity: 0.9;
            font-size: 14px;
        }
        .nav {
            background: rgba(0,0,0,0.1);
            margin-top: 15px;
            padding: 10px 0;
            border-radius: 4px;
        }
        .nav a {
            color: white;
            text-decoration: none;
            padding: 8px 15px;
            margin-right: 5px;
            border-radius: 4px;
            transition: background 0.3s;
        }
        .nav a:hover {
            background: rgba(255,255,255,0.2);
        }
        .nav a.active {
            background: rgba(255,255,255,0.3);
        }
        .section {
            background: white;
            max-width: 1200px;
            margin: 30px auto;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        .page-title {
            font-size: 32px;
            color: #009639;
            margin-bottom: 10px;
        }
        .page-intro {
            color: #666;
            font-size: 16px;
            margin-bottom: 30px;
        }
        .section-title {
            font-size: 24px;
            color: #333;
            margin: 30px 0 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #009639;
        }
        .section-subtitle {
            font-size: 18px;
            color: #009639;
            margin: 25px 0 15px;
        }
        .config-example {
            background: #263238;
            color: #aed581;
            padding: 20px;
            border-radius: 6px;
            margin: 15px 0;
            overflow-x: auto;
        }
        .config-example pre {
            margin: 0;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.6;
        }
        .note-box {
            background: #d1ecf1;
            border-left: 4px solid #17a2b8;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
        }
        .warning-box {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
        }
        .tip-box {
            background: #d4edda;
            border-left: 4px solid #28a745;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
        }
        .info-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        .info-table th, .info-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        .info-table th {
            background: #f8f9fa;
            font-weight: bold;
        }
        .info-table code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
        }
        .log-levels {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .log-level {
            padding: 15px;
            border-radius: 6px;
            color: white;
        }
        .log-level.emerg { background: #d32f2f; }
        .log-level.alert { background: #f44336; }
        .log-level.crit { background: #ff5722; }
        .log-level.error { background: #ff9800; }
        .log-level.warn { background: #ffc107; color: #333; }
        .log-level.notice { background: #2196f3; }
        .log-level.info { background: #4caf50; }
        .log-level.debug { background: #9e9e9e; }
        .debug-section {
            background: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        .debug-section h4 {
            color: #009639;
            margin-top: 0;
        }
        .timeline {
            position: relative;
            padding-left: 30px;
            margin: 20px 0;
        }
        .timeline-item {
            position: relative;
            padding-bottom: 20px;
            border-left: 2px solid #009639;
            padding-left: 20px;
        }
        .timeline-item::before {
            content: '';
            position: absolute;
            left: -6px;
            top: 0;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #009639;
        }
        .timeline-item h4 {
            margin: 0 0 5px 0;
            color: #009639;
        }
        .checklist {
            list-style: none;
            margin: 15px 0;
        }
        .checklist li {
            padding: 10px 0;
            padding-left: 30px;
            position: relative;
        }
        .checklist li::before {
            content: 'â˜';
            position: absolute;
            left: 0;
            font-size: 18px;
            color: #009639;
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="container">
            <h1>Nginx æ·±åº¦å­¦ä¹ </h1>
            <p class="tagline">æ­ç§˜å†…éƒ¨æœºåˆ¶ï¼ŒæŒæ¡æ ¸å¿ƒé…ç½®</p>
            <nav class="nav">
                <a href="index.html">é¦–é¡µ</a>
                <a href="mechanism.html">å†…éƒ¨æœºåˆ¶</a>
                <a href="request-flow.html">è¯·æ±‚å¤„ç†</a>
                <a href="directives.html">æŒ‡ä»¤è¯¦è§£</a>
                <a href="configs.html">åº”ç”¨é…ç½®</a>
                <a href="debug.html" class="nav-link active">æ—¥å¿—è°ƒè¯•</a>
            </nav>
        </div>
    </header>

    <main>
        <section class="section">
            <div class="container">
                <h1 class="page-title">ğŸ” Nginx æ—¥å¿—è°ƒè¯•</h1>
                <p class="page-intro">æŒæ¡ Nginx æ—¥å¿—åˆ†æå’Œè°ƒè¯•æŠ€å·§ï¼Œå¿«é€Ÿå®šä½å’Œè§£å†³é—®é¢˜</p>
            </div>
        </section>

        <section class="section">
            <div class="container">
                <h2 class="section-title">ğŸ“ æ—¥å¿—çº§åˆ«è¯¦è§£</h2>
                
                <div class="log-levels">
                    <div class="log-level emerg">emerg<br><small>ç´§æ€¥ - ç³»ç»Ÿä¸å¯ç”¨</small></div>
                    <div class="log-level alert">alert<br><small>è­¦æŠ¥ - éœ€ç«‹å³è¡ŒåŠ¨</small></div>
                    <div class="log-level crit">crit<br><small>ä¸¥é‡ - ä¸¥é‡é”™è¯¯</small></div>
                    <div class="log-level error">error<br><small>é”™è¯¯ - ä¸€èˆ¬é”™è¯¯</small></div>
                    <div class="log-level warn">warn<br><small>è­¦å‘Š - æ½œåœ¨é—®é¢˜</small></div>
                    <div class="log-level notice">notice<br><small>é€šçŸ¥ - æ­£å¸¸ä½†é‡è¦</small></div>
                    <div class="log-level info">info<br><small>ä¿¡æ¯ - ä¸€èˆ¬ä¿¡æ¯</small></div>
                    <div class="log-level debug">debug<br><small>è°ƒè¯• - è¯¦ç»†è°ƒè¯•</small></div>
                </div>

                <div class="config-example">
                    <pre># è®¾ç½®é”™è¯¯æ—¥å¿—çº§åˆ«
error_log /var/log/nginx/error.log warn;

# ä¸åŒä½ç½®å¯è®¾ç½®ä¸åŒçº§åˆ«
http {
    error_log /var/log/nginx/http_error.log error;
    
    server {
        error_log /var/log/nginx/server_error.log notice;
        
        location / {
            error_log /var/log/nginx/location_error.log debug;
        }
    }
}</pre>
                </div>

                <div class="tip-box">
                    <strong>ğŸ’¡ è°ƒè¯•å»ºè®®ï¼š</strong> ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ <code>warn</code> æˆ– <code>error</code> çº§åˆ«ï¼Œè°ƒè¯•æ—¶ä½¿ç”¨ <code>debug</code> çº§åˆ«ï¼ˆéœ€è¦ç¼–è¯‘æ—¶å¯ç”¨ <code>--with-debug</code>ï¼‰
                </div>
            </div>
        </section>

        <section class="section">
            <div class="container">
                <h2 class="section-title">ğŸ“Š è®¿é—®æ—¥å¿—é…ç½®</h2>
                
                <h3 class="section-subtitle">è‡ªå®šä¹‰æ—¥å¿—æ ¼å¼</h3>
                <div class="config-example">
                    <pre>http {
    # åŸºç¡€æ—¥å¿—æ ¼å¼
    log_format basic '$remote_addr - $remote_user [$time_local] '
                     '"$request" $status $body_bytes_sent '
                     '"$http_referer" "$http_user_agent"';
    
    # è¯¦ç»†æ—¥å¿—æ ¼å¼ï¼ˆæ¨èï¼‰
    log_format main '$remote_addr - $remote_user [$time_local] '
                    '"$request" $status $body_bytes_sent '
                    '"$http_referer" "$http_user_agent" '
                    '"$http_x_forwarded_for" '
                    'rt=$request_time '
                    'uct="$upstream_connect_time" '
                    'uht="$upstream_header_time" '
                    'urt="$upstream_response_time"';
    
    # JSON æ ¼å¼ï¼ˆä¾¿äºæ—¥å¿—åˆ†æç³»ç»Ÿï¼‰
    log_format json escape=json '{'
        '"time":"$time_iso8601",'
        '"remote_addr":"$remote_addr",'
        '"request":"$request",'
        '"status": "$status",'
        '"body_bytes_sent":"$body_bytes_sent",'
        '"request_time":"$request_time",'
        '"upstream_response_time":"$upstream_response_time",'
        '"http_referrer":"$http_referer",'
        '"http_user_agent":"$http_user_agent"'
    '}';
    
    server {
        access_log /var/log/nginx/access.log main;
    }
}</pre>
                </div>

                <h3 class="section-subtitle">å¸¸ç”¨æ—¥å¿—å˜é‡</h3>
                <table class="info-table">
                    <thead>
                        <tr><th>å˜é‡</th><th>è¯´æ˜</th><th>ç¤ºä¾‹</th></tr>
                    </thead>
                    <tbody>
                        <tr><td><code>$remote_addr</code></td><td>å®¢æˆ·ç«¯ IP</td><td><code>192.168.1.100</code></td></tr>
                        <tr><td><code>$time_local</code></td><td>æœ¬åœ°æ—¶é—´</td><td><code>10/Feb/2025:14:30:25 +0800</code></td></tr>
                        <tr><td><code>$request</code></td><td>å®Œæ•´è¯·æ±‚</td><td><code>GET /api/users HTTP/1.1</code></td></tr>
                        <tr><td><code>$status</code></td><td>å“åº”çŠ¶æ€ç </td><td><code>200</code>, <code>404</code>, <code>500</code></td></tr>
                        <tr><td><code>$body_bytes_sent</code></td><td>å‘é€å­—èŠ‚æ•°</td><td><code>1234</code></td></tr>
                        <tr><td><code>$request_time</code></td><td>è¯·æ±‚å¤„ç†æ—¶é—´</td><td><code>0.523</code> ç§’</td></tr>
                        <tr><td><code>$upstream_response_time</code></td><td>åç«¯å“åº”æ—¶é—´</td><td><code>0.489</code> ç§’</td></tr>
                        <tr><td><code>$upstream_connect_time</code></td><td>åç«¯è¿æ¥æ—¶é—´</td><td><code>0.002</code> ç§’</td></tr>
                        <tr><td><code>$http_referer</code></td><td>æ¥æºé¡µé¢</td><td><code>https://example.com</code></td></tr>
                        <tr><td><code>$http_user_agent</code></td><td>ç”¨æˆ·ä»£ç†</td><td><code>Mozilla/5.0...</code></td></tr>
                    </tbody>
                </table>
            </div>
        </section>

        <section class="section">
            <div class="container">
                <h2 class="section-title">ğŸ”§ è°ƒè¯•æŠ€å·§ä¸æ–¹æ³•</h2>
                
                <div class="debug-section">
                    <h4>1. å®æ—¶æŸ¥çœ‹æ—¥å¿—</h4>
                    <div class="config-example">
                        <pre># å®æ—¶æŸ¥çœ‹é”™è¯¯æ—¥å¿—
tail -f /var/log/nginx/error.log

# å®æ—¶æŸ¥çœ‹è®¿é—®æ—¥å¿—
tail -f /var/log/nginx/access.log

# åŒæ—¶æŸ¥çœ‹å¤šä¸ªæ—¥å¿—
tail -f /var/log/nginx/{error,access}.log

# æ˜¾ç¤ºè¡Œå·
tail -fn 100 /var/log/nginx/error.log | nl

# é«˜äº®æ˜¾ç¤ºé”™è¯¯
tail -f /var/log/nginx/error.log | grep --color=always -E 'error|crit|emerg'</pre>
                    </div>
                </div>

                <div class="debug-section">
                    <h4>2. æ—¥å¿—åˆ†æå‘½ä»¤</h4>
                    <div class="config-example">
                        <pre># ç»Ÿè®¡è®¿é—®é‡æœ€é«˜çš„ 10 ä¸ª IP
awk '{print $1}' /var/log/nginx/access.log | sort | uniq -c | sort -rn | head -10

# ç»Ÿè®¡ HTTP çŠ¶æ€ç åˆ†å¸ƒ
awk '{print $9}' /var/log/nginx/access.log | sort | uniq -c | sort -rn

# æŸ¥æ‰¾ 5xx é”™è¯¯
awk '$9 ~ /^5[0-9]{2}$/' /var/log/nginx/access.log

# æŸ¥æ‰¾å“åº”æ—¶é—´è¶…è¿‡ 1 ç§’çš„è¯·æ±‚
awk '($NF > 1) {print $0}' /var/log/nginx/access.log

# ç»Ÿè®¡æ¯åˆ†é’Ÿçš„è¯·æ±‚æ•°
awk -F'[' '{print $2}' /var/log/nginx/access.log | awk -F':' '{print $1":"$2":"$3}' | uniq -c

# æŸ¥æ‰¾ç‰¹å®š URL çš„è®¿é—®
grep "/api/users" /var/log/nginx/access.log

# ç»Ÿè®¡ User-Agent åˆ†å¸ƒ
awk -F'"' '{print $6}' /var/log/nginx/access.log | sort | uniq -c | sort -rn | head -10</pre>
                    </div>
                </div>

                <div class="debug-section">
                    <h4>3. é…ç½®æµ‹è¯•ä¸éªŒè¯</h4>
                    <div class="config-example">
                        <pre># æµ‹è¯•é…ç½®æ–‡ä»¶è¯­æ³•
nginx -t

# æ˜¾ç¤ºè¯¦ç»†é”™è¯¯ä¿¡æ¯
nginx -t -V

# é‡æ–°åŠ è½½é…ç½®ï¼ˆä¸ä¸­æ–­æœåŠ¡ï¼‰
nginx -s reload

# ä¼˜é›…å…³é—­ Nginx
nginx -s quit

# å¿«é€Ÿå…³é—­
nginx -s stop

# æŸ¥çœ‹ Nginx ç‰ˆæœ¬å’Œç¼–è¯‘å‚æ•°
nginx -V</pre>
                    </div>
                </div>

                <div class="debug-section">
                    <h4>4. è°ƒè¯•æ¨¡å¼é…ç½®</h4>
                    <div class="config-example">
                        <pre># å¯ç”¨è°ƒè¯•æ—¥å¿—ï¼ˆéœ€è¦ nginx ç¼–è¯‘æ—¶å¯ç”¨ --with-debugï¼‰
error_log /var/log/nginx/error.log debug;

# åªè®°å½•ç‰¹å®šå®¢æˆ·ç«¯çš„è°ƒè¯•ä¿¡æ¯
events {
    debug_connection 192.168.1.0/24;
}

# å¯ç”¨é‡å†™æ—¥å¿—
rewrite_log on;

# åœ¨ server å—ä¸­
server {
    # è®°å½•è¯¦ç»†æ—¥å¿—
    error_log /var/log/nginx/debug.log debug;
    
    # å¯ç”¨é‡å†™æ—¥å¿—
    rewrite_log on;
    
    location / {
        # æ·»åŠ è°ƒè¯•å¤´
        add_header X-Request-ID $request_id;
        add_header X-Real-IP $remote_addr;
        add_header X-Request-Time $request_time;
    }
}</pre>
                    </div>
                    <div class="warning-box">
                        <strong>âš ï¸ æ³¨æ„ï¼š</strong> è°ƒè¯•æ¨¡å¼ä¼šäº§ç”Ÿå¤§é‡æ—¥å¿—ï¼Œä»…å»ºè®®åœ¨æµ‹è¯•ç¯å¢ƒæˆ–çŸ­æ—¶é—´å†…ä½¿ç”¨ï¼Œç”Ÿäº§ç¯å¢ƒä½¿ç”¨åè®°å¾—å…³é—­ã€‚
                    </div>
                </div>
            </div>
        </section>

        <section class="section">
            <div class="container">
                <h2 class="section-title">ğŸ› å¸¸è§é—®é¢˜æ’æŸ¥</h2>
                
                <h3 class="section-subtitle">é—®é¢˜æ’æŸ¥æµç¨‹</h3>
                <div class="timeline">
                    <div class="timeline-item">
                        <h4>1. ç¡®è®¤é—®é¢˜ç°è±¡</h4>
                        <p>è®°å½•é”™è¯¯ä¿¡æ¯ã€å‘ç”Ÿæ—¶é—´ã€å½±å“èŒƒå›´ã€å¤ç°æ­¥éª¤</p>
                    </div>
                    <div class="timeline-item">
                        <h4>2. æ£€æŸ¥é”™è¯¯æ—¥å¿—</h4>
                        <p>æŸ¥çœ‹ <code>/var/log/nginx/error.log</code>ï¼Œæ³¨æ„æ—¶é—´æˆ³å’Œé”™è¯¯çº§åˆ«</p>
                    </div>
                    <div class="timeline-item">
                        <h4>3. æ£€æŸ¥é…ç½®è¯­æ³•</h4>
                        <p>è¿è¡Œ <code>nginx -t</code> éªŒè¯é…ç½®æ–‡ä»¶</p>
                    </div>
                    <div class="timeline-item">
                        <h4>4. æ£€æŸ¥æ–‡ä»¶å’Œç›®å½•æƒé™</h4>
                        <p>ç¡®ä¿ Nginx ç”¨æˆ·æœ‰æƒé™è¯»å–ç›¸å…³æ–‡ä»¶</p>
                    </div>
                    <div class="timeline-item">
                        <h4>5. æ£€æŸ¥åç«¯æœåŠ¡</h4>
                        <p>ç¡®è®¤ upstream æœåŠ¡å™¨æ­£å¸¸è¿è¡Œ</p>
                    </div>
                    <div class="timeline-item">
                        <h4>6. å¯ç”¨è°ƒè¯•æ—¥å¿—</h4>
                        <p>å¦‚é—®é¢˜ä»æœªè§£å†³ï¼Œå¯ç”¨ debug çº§åˆ«æ—¥å¿—è¯¦ç»†åˆ†æ</p>
                    </div>
                </div>

                <h3 class="section-subtitle">å¸¸è§é”™è¯¯åŠè§£å†³æ–¹æ¡ˆ</h3>
                <table class="info-table">
                    <thead>
                        <tr><th>é”™è¯¯ä¿¡æ¯</th><th>å¯èƒ½åŸå› </th><th>è§£å†³æ–¹æ¡ˆ</th></tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>403 Forbidden</code></td>
                            <td>æƒé™ä¸è¶³ã€index æ–‡ä»¶ä¸å­˜åœ¨</td>
                            <td>æ£€æŸ¥æ–‡ä»¶æƒé™ã€ç¡®è®¤ index æŒ‡ä»¤é…ç½®</td>
                        </tr>
                        <tr>
                            <td><code>404 Not Found</code></td>
                            <td>æ–‡ä»¶ä¸å­˜åœ¨ã€root/alias è·¯å¾„é”™è¯¯</td>
                            <td>æ£€æŸ¥æ–‡ä»¶è·¯å¾„ã€ç¡®è®¤ root/alias é…ç½®</td>
                        </tr>
                        <tr>
                            <td><code>502 Bad Gateway</code></td>
                            <td>åç«¯æœåŠ¡æœªå¯åŠ¨ã€è¿æ¥è¢«æ‹’ç»</td>
                            <td>æ£€æŸ¥åç«¯æœåŠ¡çŠ¶æ€ã€ç¡®è®¤ proxy_pass åœ°å€</td>
                        </tr>
                        <tr>
                            <td><code>504 Gateway Timeout</code></td>
                            <td>åç«¯å“åº”è¶…æ—¶</td>
                            <td>å¢åŠ  proxy_read_timeoutã€ä¼˜åŒ–åç«¯æ€§èƒ½</td>
                        </tr>
                        <tr>
                            <td><code>connect() failed (111: Connection refused)</code></td>
                            <td>åç«¯æœåŠ¡æœªç›‘å¬æŒ‡å®šç«¯å£</td>
                            <td>æ£€æŸ¥åç«¯æœåŠ¡æ˜¯å¦è¿è¡Œã€ç«¯å£æ˜¯å¦æ­£ç¡®</td>
                        </tr>
                        <tr>
                            <td><code>permission denied</code></td>
                            <td>æ–‡ä»¶/ç›®å½•æƒé™ä¸è¶³</td>
                            <td>ä¿®æ”¹æ–‡ä»¶æƒé™ã€æ£€æŸ¥ SELinux/AppArmor</td>
                        </tr>
                        <tr>
                            <td><code>open() failed (2: No such file or directory)</code></td>
                            <td>æ–‡ä»¶ä¸å­˜åœ¨</td>
                            <td>æ£€æŸ¥æ–‡ä»¶è·¯å¾„ã€ç¡®è®¤æ–‡ä»¶ç¡®å®å­˜åœ¨</td>
                        </tr>
                        <tr>
                            <td><code>upstream prematurely closed connection</code></td>
                            <td>åç«¯æœåŠ¡å´©æºƒæˆ–ä¸»åŠ¨å…³é—­è¿æ¥</td>
                            <td>æ£€æŸ¥åç«¯æ—¥å¿—ã€å¢åŠ åç«¯èµ„æº</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <section class="section">
            <div class="container">
                <h2 class="section-title">ğŸ“ˆ æ—¥å¿—åˆ†æå·¥å…·</h2>
                
                <h3 class="section-subtitle">GoAccessï¼ˆå®æ—¶åˆ†æï¼‰</h3>
                <div class="config-example">
                    <pre># å®‰è£… GoAccess
# Ubuntu/Debian
sudo apt-get install goaccess

# CentOS/RHEL
sudo yum install goaccess

# ç”Ÿæˆå®æ—¶ HTML æŠ¥å‘Š
goaccess /var/log/nginx/access.log -o /var/www/html/report.html --log-format=COMBINED

# ç»ˆç«¯ç•Œé¢
goaccess /var/log/nginx/access.log --log-format=COMBINED

# è‡ªå®šä¹‰æ—¥å¿—æ ¼å¼
goaccess /var/log/nginx/access.log \
  --log-format='%h %^[%d:%t %^] "%r" %s %b "%R" "%u" %D' \
  --date-format=%d/%b/%Y \
  --time-format=%H:%M:%S</pre>
                </div>

                <h3 class="section-subtitle">AWStatsï¼ˆç»Ÿè®¡åˆ†æï¼‰</h3>
                <div class="config-example">
                    <pre># å®‰è£… AWStats
sudo apt-get install awstats

# é…ç½®
sudo vim /etc/awstats/awstats.conf

# è®¾ç½®æ—¥å¿—è·¯å¾„
LogFile="/var/log/nginx/access.log"
LogFormat=1

# ç”ŸæˆæŠ¥å‘Š
sudo /usr/lib/cgi-bin/awstats.pl -config=mysite -update
sudo /usr/lib/cgi-bin/awstats.pl -config=mysite -show</pre>
                </div>

                <h3 class="section-subtitle">ELK Stackï¼ˆä¼ä¸šçº§ï¼‰</h3>
                <div class="config-example">
                    <pre># Filebeat é…ç½®ï¼ˆå‘é€æ—¥å¿—åˆ° Elasticsearchï¼‰
sudo vim /etc/filebeat/filebeat.yml

filebeat.inputs:
- type: log
  enabled: true
  paths:
    - /var/log/nginx/access.log
    - /var/log/nginx/error.log
  fields:
    type: nginx

output.elasticsearch:
  hosts: ["localhost:9200"]
  indices:
    - index: "nginx-access-%{+yyyy.MM.dd}"
    - index: "nginx-error-%{+yyyy.MM.dd}"

# å¯åŠ¨ Filebeat
sudo systemctl start filebeat</pre>
                </div>

                <h3 class="section-subtitle">ç®€å•è„šæœ¬åˆ†æ</h3>
                <div class="config-example">
                    <pre>#!/bin/bash
# nginx-analyze.sh - ç®€å•æ—¥å¿—åˆ†æè„šæœ¬

LOG_FILE="/var/log/nginx/access.log"

echo "=== Nginx æ—¥å¿—åˆ†æ ==="
echo "æ—¥å¿—æ–‡ä»¶ï¼š$LOG_FILE"
echo ""

echo "ã€æ€»è¯·æ±‚æ•°ã€‘"
wc -l < $LOG_FILE

echo ""
echo "ã€çŠ¶æ€ç åˆ†å¸ƒã€‘"
awk '{print $9}' $LOG_FILE | sort | uniq -c | sort -rn

echo ""
echo "ã€Top 10 IPã€‘"
awk '{print $1}' $LOG_FILE | sort | uniq -c | sort -rn | head -10

echo ""
echo "ã€Top 10 è¯·æ±‚ URLã€‘"
awk '{print $7}' $LOG_FILE | sort | uniq -c | sort -rn | head -10

echo ""
echo "ã€æ…¢è¯·æ±‚ï¼ˆ>1 ç§’ï¼‰ã€‘"
awk '($NF > 1) {print $7, $NF"s"}' $LOG_FILE | sort -t's' -k2 -rn | head -10</pre>
                </div>
            </div>
        </section>

        <section class="section">
            <div class="container">
                <h2 class="section-title">âœ… è°ƒè¯•æ£€æŸ¥æ¸…å•</h2>
                
                <ul class="checklist">
                    <li>ç¡®è®¤ Nginx æœåŠ¡æ­£åœ¨è¿è¡Œ (<code>systemctl status nginx</code>)</li>
                    <li>æ£€æŸ¥é…ç½®æ–‡ä»¶è¯­æ³• (<code>nginx -t</code>)</li>
                    <li>æŸ¥çœ‹é”™è¯¯æ—¥å¿—ä¸­çš„æœ€æ–°é”™è¯¯</li>
                    <li>ç¡®è®¤ç›‘å¬ç«¯å£æ­£ç¡® (<code>netstat -tlnp | grep nginx</code>)</li>
                    <li>æ£€æŸ¥é˜²ç«å¢™è§„åˆ™ (<code>iptables -L</code> æˆ– <code>ufw status</code>)</li>
                    <li>éªŒè¯ SSL è¯ä¹¦è·¯å¾„å’Œæƒé™ï¼ˆå¦‚ä½¿ç”¨ HTTPSï¼‰</li>
                    <li>æ£€æŸ¥ upstream æœåŠ¡å™¨æ˜¯å¦å¯è¾¾</li>
                    <li>ç¡®è®¤æ–‡ä»¶å’Œç›®å½•æƒé™æ­£ç¡®</li>
                    <li>æ£€æŸ¥ç£ç›˜ç©ºé—´ (<code>df -h</code>)</li>
                    <li>æŸ¥çœ‹ç³»ç»Ÿèµ„æºä½¿ç”¨æƒ…å†µ (<code>top</code>, <code>free -m</code>)</li>
                    <li>æµ‹è¯• DNS è§£æ (<code>nslookup</code> æˆ– <code>dig</code>)</li>
                    <li>ä½¿ç”¨ <code>curl -v</code> æµ‹è¯•è¯·æ±‚å¹¶æŸ¥çœ‹è¯¦ç»†å“åº”</li>
                </ul>

                <div class="tip-box">
                    <strong>ğŸ’¡ è°ƒè¯•å‘½ä»¤æ±‡æ€»ï¼š</strong>
                    <pre>
# æœåŠ¡çŠ¶æ€
systemctl status nginx

# é…ç½®æµ‹è¯•
nginx -t

# é‡æ–°åŠ è½½
nginx -s reload

# æŸ¥çœ‹ç›‘å¬ç«¯å£
netstat -tlnp | grep nginx

# å®æ—¶æ—¥å¿—
tail -f /var/log/nginx/error.log

# è¿æ¥æµ‹è¯•
curl -v http://localhost/

# æ€§èƒ½æµ‹è¯•
ab -n 1000 -c 100 http://localhost/</pre>
                </div>
            </div>
        </section>
    </main>
</body>
</html>
