<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nginx åº”ç”¨é…ç½® - å®æˆ˜åœºæ™¯è¯¦è§£</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .config-section {
            background: white;
            border-left: 4px solid #007acc;
            padding: 25px;
            margin: 25px 0;
            border-radius: 4px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        .config-section h3 {
            color: #007acc;
            margin-top: 0;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            user-select: none;
        }
        .config-section h3:hover {
            color: #005a9e;
        }
        .config-section h3::after {
            content: '+';
            font-size: 20px;
            font-weight: bold;
            transition: transform 0.3s ease;
        }
        .config-section.collapsed h3::after {
            content: '+';
        }
        .config-section:not(.collapsed) h3::after {
            content: 'âˆ’';
        }
        .config-section .config-content {
            display: none;
        }
        .config-section:not(.collapsed) .config-content {
            display: block;
        }
        .config-example {
            background: #263238;
            color: #aed581;
            padding: 20px;
            border-radius: 6px;
            margin: 15px 0;
            overflow-x: auto;
        }
        .config-example pre {
            margin: 0;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.6;
        }
        .config-example code {
            color: #aed581;
        }
        .note-box {
            background: #d1ecf1;
            border-left: 4px solid #17a2b8;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
        }
        .warning-box {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
        }
        .tip-box {
            background: #d4edda;
            border-left: 4px solid #28a745;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
        }
        .info-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        .info-table th, .info-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        .info-table th {
            background: #f8f9fa;
            font-weight: bold;
        }
        .info-table code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
        }
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        .comparison-table th, .comparison-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        .comparison-table th {
            background: #f8f9fa;
            font-weight: bold;
        }
        .flow-container {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            overflow-x: auto;
        }
        .flow-diagram {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        .flow-box {
            background: white;
            border: 2px solid #007acc;
            border-radius: 8px;
            padding: 12px;
            min-width: 100px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .flow-arrow {
            color: #666;
            font-size: 20px;
        }
        .scenario-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .scenario-card h4 {
            margin-top: 0;
        }
        .param-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            font-size: 14px;
        }
        .param-table th, .param-table td {
            padding: 10px;
            border: 1px solid #ddd;
        }
        .param-table th {
            background: #f5f5f5;
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="container">
            <div class="logo">
                <h1>Nginx æ·±åº¦å­¦ä¹ </h1>
                <p class="tagline">æ­ç§˜å†…éƒ¨æœºåˆ¶ï¼ŒæŒæ¡æ ¸å¿ƒé…ç½®</p>
            </div>
            <nav class="nav">
                <a href="index.html" class="nav-link">é¦–é¡µ</a>
                <a href="mechanism.html" class="nav-link">å†…éƒ¨æœºåˆ¶</a>
                <a href="request-flow.html" class="nav-link">è¯·æ±‚å¤„ç†</a>
                <a href="directives.html" class="nav-link">æŒ‡ä»¤è¯¦è§£</a>
                <a href="configs.html" class="nav-link active">åº”ç”¨é…ç½®</a>
                <a href="debug.html" class="nav-link">æ—¥å¿—è°ƒè¯•</a>
            </nav>
        </div>
    </header>

    <main>
        <!-- è´Ÿè½½å‡è¡¡é…ç½® -->
        <section class="section">
            <div class="container">
                <h2 class="section-title">âš–ï¸ è´Ÿè½½å‡è¡¡é…ç½®</h2>
                
                <div class="flow-container">
                    <div class="flow-diagram">
                        <div class="flow-box">
                            <strong>å®¢æˆ·ç«¯</strong>
                        </div>
                        <div class="flow-arrow">â†’</div>
                        <div class="flow-box">
                            <strong>Nginx</strong>
                            <br><small>è´Ÿè½½å‡è¡¡å™¨</small>
                        </div>
                        <div class="flow-arrow">â†’</div>
                        <div class="flow-box">
                            <strong>ä¸Šæ¸¸æœåŠ¡å™¨</strong>
                        </div>
                        <div class="flow-arrow">â†’</div>
                        <div class="flow-box">Server 1</div>
                        <div class="flow-box">Server 2</div>
                        <div class="flow-box">Server 3</div>
                    </div>
                </div>

                <div class="config-section">
                    <h3>1. è½®è¯¢ï¼ˆRound Robinï¼‰</h3>
                    <p>é»˜è®¤ç­–ç•¥ï¼ŒæŒ‰æ—¶é—´é¡ºåºé€ä¸€åˆ†é…è¯·æ±‚åˆ°åç«¯æœåŠ¡å™¨ã€‚</p>
                    <div class="config-example">
                        <pre>upstream backend {
    # é»˜è®¤è½®è¯¢ï¼Œæ— éœ€é¢å¤–é…ç½®
    server 192.168.1.10:8080;
    server 192.168.1.11:8080;
    server 192.168.1.12:8080;
}

server {
    location / {
        proxy_pass http://backend;
    }
}</pre>
                    </div>
                    <div class="tip-box">
                        <strong>âœ… é€‚ç”¨åœºæ™¯ï¼š</strong> åç«¯æœåŠ¡å™¨æ€§èƒ½ç›¸è¿‘ï¼Œæ— çŠ¶æ€æœåŠ¡
                    </div>
                </div>

                <div class="config-section">
                    <h3>2. æƒé‡ï¼ˆWeightï¼‰</h3>
                    <p>æŒ‰æœåŠ¡å™¨æƒé‡æ¯”ä¾‹åˆ†é…è¯·æ±‚ï¼Œæƒé‡è¶Šé«˜åˆ†é…è¶Šå¤šã€‚</p>
                    <div class="config-example">
                        <pre>upstream backend {
    server 192.168.1.10:8080 weight=3;  # 60% è¯·æ±‚
    server 192.168.1.11:8080 weight=2;  # 40% è¯·æ±‚
    server 192.168.1.12:8080 weight=1;  # 20% è¯·æ±‚
}

server {
    location / {
        proxy_pass http://backend;
    }
}</pre>
                    </div>
                    <div class="tip-box">
                        <strong>âœ… é€‚ç”¨åœºæ™¯ï¼š</strong> åç«¯æœåŠ¡å™¨æ€§èƒ½ä¸å‡ï¼ŒæŒ‰æ€§èƒ½æ¯”ä¾‹åˆ†é…
                    </div>
                </div>

                <div class="config-section">
                    <h3>3. IP å“ˆå¸Œï¼ˆIP Hashï¼‰</h3>
                    <p>æ ¹æ®å®¢æˆ·ç«¯ IP å“ˆå¸Œå€¼åˆ†é…ï¼ŒåŒä¸€ IP å›ºå®šè®¿é—®åŒä¸€æœåŠ¡å™¨ã€‚</p>
                    <div class="config-example">
                        <pre>upstream backend {
    ip_hash;  # å¯ç”¨ IP å“ˆå¸Œ
    server 192.168.1.10:8080;
    server 192.168.1.11:8080;
    server 192.168.1.12:8080;
}

server {
    location / {
        proxy_pass http://backend;
    }
}</pre>
                    </div>
                    <div class="note-box">
                        <strong>ğŸ’¡ ä¼šè¯ä¿æŒï¼š</strong> é€‚ç”¨äºéœ€è¦ä¼šè¯ä¿æŒçš„åœºæ™¯ï¼Œå¦‚ç™»å½•çŠ¶æ€ã€è´­ç‰©è½¦ç­‰
                    </div>
                </div>

                <div class="config-section">
                    <h3>4. æœ€å°‘è¿æ¥ï¼ˆLeast Connectionsï¼‰</h3>
                    <p>å°†è¯·æ±‚åˆ†é…ç»™å½“å‰è¿æ¥æ•°æœ€å°‘çš„æœåŠ¡å™¨ã€‚</p>
                    <div class="config-example">
                        <pre>upstream backend {
    least_conn;  # æœ€å°‘è¿æ¥ç­–ç•¥
    server 192.168.1.10:8080;
    server 192.168.1.11:8080;
    server 192.168.1.12:8080;
}

server {
    location / {
        proxy_pass http://backend;
    }
}</pre>
                    </div>
                    <div class="tip-box">
                        <strong>âœ… é€‚ç”¨åœºæ™¯ï¼š</strong> é•¿è¿æ¥ã€è¯·æ±‚å¤„ç†æ—¶é—´å·®å¼‚å¤§çš„åœºæ™¯
                    </div>
                </div>

                <div class="config-section">
                    <h3>5. å“ˆå¸Œï¼ˆHashï¼‰</h3>
                    <p>æ ¹æ®æŒ‡å®š key çš„å“ˆå¸Œå€¼åˆ†é…ï¼Œå¯ç”¨äºä¸€è‡´æ€§å“ˆå¸Œã€‚</p>
                    <div class="config-example">
                        <pre>upstream backend {
    hash $request_uri consistent;  # ä¸€è‡´æ€§å“ˆå¸Œ
    server 192.168.1.10:8080;
    server 192.168.1.11:8080;
    server 192.168.1.12:8080;
}

server {
    location / {
        proxy_pass http://backend;
    }
}</pre>
                    </div>
                    <div class="note-box">
                        <strong>ğŸ’¡ é€‚ç”¨åœºæ™¯ï¼š</strong> ç¼“å­˜æœåŠ¡å™¨é›†ç¾¤ã€éœ€è¦å›ºå®šæ˜ å°„çš„åœºæ™¯
                    </div>
                </div>

                <h3 class="section-subtitle">è´Ÿè½½å‡è¡¡ç­–ç•¥å¯¹æ¯”</h3>
                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th>ç­–ç•¥</th>
                            <th>ä¼˜ç‚¹</th>
                            <th>ç¼ºç‚¹</th>
                            <th>é€‚ç”¨åœºæ™¯</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>è½®è¯¢</td>
                            <td>ç®€å•ã€å¹³å‡åˆ†é…</td>
                            <td>ä¸è€ƒè™‘æœåŠ¡å™¨è´Ÿè½½</td>
                            <td>æ— çŠ¶æ€æœåŠ¡ã€æ€§èƒ½ç›¸è¿‘</td>
                        </tr>
                        <tr>
                            <td>æƒé‡</td>
                            <td>æŒ‰æ€§èƒ½åˆ†é…</td>
                            <td>éœ€æ‰‹åŠ¨é…ç½®æƒé‡</td>
                            <td>æœåŠ¡å™¨æ€§èƒ½ä¸å‡</td>
                        </tr>
                        <tr>
                            <td>IP å“ˆå¸Œ</td>
                            <td>ä¼šè¯ä¿æŒ</td>
                            <td>å¯èƒ½è´Ÿè½½ä¸å‡</td>
                            <td>éœ€è¦ä¼šè¯ä¿æŒ</td>
                        </tr>
                        <tr>
                            <td>æœ€å°‘è¿æ¥</td>
                            <td>åŠ¨æ€è´Ÿè½½å‡è¡¡</td>
                            <td>å¢åŠ è°ƒåº¦å¼€é”€</td>
                            <td>é•¿è¿æ¥ã€å¤„ç†æ—¶é—´å·®å¼‚å¤§</td>
                        </tr>
                        <tr>
                            <td>å“ˆå¸Œ</td>
                            <td>å›ºå®šæ˜ å°„ã€ä¸€è‡´æ€§</td>
                            <td>å¯èƒ½ä¸å‡</td>
                            <td>ç¼“å­˜é›†ç¾¤ã€å›ºå®šè·¯ç”±</td>
                        </tr>
                    </tbody>
                </table>

                <h3 class="section-subtitle">ä¸Šæ¸¸æœåŠ¡å™¨å‚æ•°é…ç½®</h3>
                <table class="info-table">
                    <thead>
                        <tr>
                            <th>å‚æ•°</th>
                            <th>è¯´æ˜</th>
                            <th>é»˜è®¤å€¼</th>
                            <th>ç¤ºä¾‹</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>weight=number</code></td>
                            <td>æœåŠ¡å™¨æƒé‡</td>
                            <td>1</td>
                            <td><code>weight=3</code></td>
                        </tr>
                        <tr>
                            <td><code>max_fails=number</code></td>
                            <td>æœ€å¤§å¤±è´¥æ¬¡æ•°</td>
                            <td>1</td>
                            <td><code>max_fails=3</code></td>
                        </tr>
                        <tr>
                            <td><code>fail_timeout=time</code></td>
                            <td>å¤±è´¥è¶…æ—¶æ—¶é—´</td>
                            <td>10s</td>
                            <td><code>fail_timeout=30s</code></td>
                        </tr>
                        <tr>
                            <td><code>backup</code></td>
                            <td>å¤‡ä»½æœåŠ¡å™¨</td>
                            <td>-</td>
                            <td><code>backup</code></td>
                        </tr>
                        <tr>
                            <td><code>down</code></td>
                            <td>æ ‡è®°æœåŠ¡å™¨ç¦»çº¿</td>
                            <td>-</td>
                            <td><code>down</code></td>
                        </tr>
                        <tr>
                            <td><code>max_conns=number</code></td>
                            <td>æœ€å¤§è¿æ¥æ•°é™åˆ¶</td>
                            <td>0ï¼ˆæ— é™åˆ¶ï¼‰</td>
                            <td><code>max_conns=100</code></td>
                        </tr>
                    </tbody>
                </table>

                <div class="config-example">
                    <pre>upstream backend {
    least_conn;  # æœ€å°‘è¿æ¥ç­–ç•¥
    
    server 192.168.1.10:8080 weight=3 max_fails=3 fail_timeout=30s;
    server 192.168.1.11:8080 weight=2 max_fails=3 fail_timeout=30s;
    server 192.168.1.12:8080 weight=1 backup;  # å¤‡ä»½æœåŠ¡å™¨
    server 192.168.1.13:8080 down;  # ç»´æŠ¤ä¸­
}</pre>
                </div>
            </div>
        </section>

        <!-- HTTPS/SSL é…ç½® -->
        <section class="section">
            <div class="container">
                <h2 class="section-title">ğŸ”’ HTTPS/SSL é…ç½®</h2>
                
                <div class="scenario-card">
                    <h4>ğŸ¯ åœºæ™¯ï¼šéƒ¨ç½² HTTPS ç½‘ç«™ï¼Œå¯ç”¨ TLS 1.3ï¼Œé…ç½® HSTS</h4>
                </div>

                <div class="config-section">
                    <h3>1. åŸºç¡€ HTTPS é…ç½®</h3>
                    <div class="config-example">
                        <pre>server {
    listen 443 ssl http2;
    server_name example.com www.example.com;
    
    # SSL è¯ä¹¦é…ç½®
    ssl_certificate /etc/nginx/ssl/example.com.crt;
    ssl_certificate_key /etc/nginx/ssl/example.com.key;
    
    # SSL ä¼šè¯é…ç½®
    ssl_session_cache shared:SSL:10m;
    ssl_session_timeout 1d;
    ssl_session_tickets off;  # ç¦ç”¨ä¼šè¯ç¥¨è¯
    
    location / {
        proxy_pass http://backend;
    }
}

# HTTP å¼ºåˆ¶è·³è½¬ HTTPS
server {
    listen 80;
    server_name example.com www.example.com;
    return 301 https://$host$request_uri;
}</pre>
                    </div>
                </div>

                <div class="config-section">
                    <h3>2. å®‰å…¨ SSL é…ç½®ï¼ˆæ¨èï¼‰</h3>
                    <div class="config-example">
                        <pre>server {
    listen 443 ssl http2;
    server_name example.com;
    
    # è¯ä¹¦é…ç½®
    ssl_certificate /etc/nginx/ssl/fullchain.pem;
    ssl_certificate_key /etc/nginx/ssl/privkey.pem;
    
    # åè®®ç‰ˆæœ¬ï¼ˆä»… TLS 1.2 å’Œ 1.3ï¼‰
    ssl_protocols TLSv1.2 TLSv1.3;
    
    # åŠ å¯†å¥—ä»¶
    ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384;
    ssl_prefer_server_ciphers off;
    
    # SSL ä¼šè¯
    ssl_session_cache shared:SSL:10m;
    ssl_session_timeout 1d;
    ssl_session_tickets off;
    
    # OCSP Stapling
    ssl_stapling on;
    ssl_stapling_verify on;
    ssl_trusted_certificate /etc/nginx/ssl/chain.pem;
    resolver 8.8.8.8 8.8.4.4 valid=300s;
    
    location / {
        proxy_pass http://backend;
    }
}</pre>
                    </div>
                    <div class="tip-box">
                        <strong>âœ… å®‰å…¨å»ºè®®ï¼š</strong> ç¦ç”¨ TLS 1.0 å’Œ 1.1ï¼Œä½¿ç”¨å¼ºåŠ å¯†å¥—ä»¶ï¼Œå¯ç”¨ OCSP Stapling
                    </div>
                </div>

                <div class="config-section">
                    <h3>3. HSTS é…ç½®</h3>
                    <div class="config-example">
                        <pre>server {
    listen 443 ssl http2;
    server_name example.com;
    
    # ... SSL é…ç½® ...
    
    # HSTS (HTTP Strict Transport Security)
    add_header Strict-Transport-Security "max-age=63072000; includeSubDomains; preload" always;
    
    # å…¶ä»–å®‰å…¨å¤´
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header X-XSS-Protection "1; mode=block" always;
    add_header Referrer-Policy "strict-origin-when-cross-origin" always;
    
    location / {
        proxy_pass http://backend;
    }
}</pre>
                    </div>
                    <div class="note-box">
                        <strong>ğŸ’¡ HSTS è¯´æ˜ï¼š</strong> å¼ºåˆ¶æµè§ˆå™¨ä½¿ç”¨ HTTPSï¼Œé˜²æ­¢åè®®é™çº§æ”»å‡»ã€‚max-age å•ä½ä¸ºç§’ï¼ŒincludeSubDomains åŒ…å«å­åŸŸåï¼Œpreload å¯æäº¤åˆ°æµè§ˆå™¨é¢„åŠ è½½åˆ—è¡¨ã€‚
                    </div>
                </div>

                <div class="config-section">
                    <h3>4. å¤šåŸŸå SSL è¯ä¹¦é…ç½®</h3>
                    <div class="config-example">
                        <pre># æ–¹æ¡ˆ 1ï¼šå¤šåŸŸåè¯ä¹¦
server {
    listen 443 ssl http2;
    server_name example.com www.example.com api.example.com;
    
    ssl_certificate /etc/nginx/ssl/multi-domain.crt;
    ssl_certificate_key /etc/nginx/ssl/multi-domain.key;
    
    location / {
        proxy_pass http://backend;
    }
}

# æ–¹æ¡ˆ 2ï¼šé€šé…ç¬¦è¯ä¹¦
server {
    listen 443 ssl http2;
    server_name *.example.com;
    
    ssl_certificate /etc/nginx/ssl/wildcard.crt;
    ssl_certificate_key /etc/nginx/ssl/wildcard.key;
}</pre>
                    </div>
                </div>
            </div>
        </section>

        <!-- åå‘ä»£ç†é…ç½® -->
        <section class="section">
            <div class="container">
                <h2 class="section-title">ğŸ”„ åå‘ä»£ç†é…ç½®</h2>
                
                <div class="flow-container">
                    <div class="flow-diagram">
                        <div class="flow-box">å®¢æˆ·ç«¯</div>
                        <div class="flow-arrow">â†’</div>
                        <div class="flow-box">Nginx<br>åå‘ä»£ç†</div>
                        <div class="flow-arrow">â†’</div>
                        <div class="flow-box">åç«¯æœåŠ¡<br>Node.js/Java/Python</div>
                    </div>
                </div>

                <div class="config-section">
                    <h3>1. åŸºç¡€åå‘ä»£ç†</h3>
                    <div class="config-example">
                        <pre>server {
    listen 80;
    server_name api.example.com;
    
    location / {
        proxy_pass http://127.0.0.1:8080;
        
        # ä¼ é€’å¿…è¦å¤´ä¿¡æ¯
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}</pre>
                    </div>
                </div>

                <div class="config-section">
                    <h3>2. å®Œæ•´ä»£ç†é…ç½®ï¼ˆæ¨èï¼‰</h3>
                    <div class="config-example">
                        <pre>upstream backend {
    server 127.0.0.1:8080;
    server 127.0.0.1:8081;
    keepalive 32;  # ä¿æŒè¿æ¥
}

server {
    listen 80;
    server_name api.example.com;
    
    location / {
        proxy_pass http://backend;
        proxy_http_version 1.1;
        
        # å¤´ä¿¡æ¯ä¼ é€’
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header Connection "";
        
        # è¶…æ—¶é…ç½®
        proxy_connect_timeout 60s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;
        
        # ç¼“å†²é…ç½®
        proxy_buffering on;
        proxy_buffer_size 4k;
        proxy_buffers 8 4k;
        proxy_busy_buffers_size 8k;
        
        # é‡è¯•é…ç½®
        proxy_next_upstream error timeout http_502 http_503 http_504;
        proxy_next_upstream_tries 3;
    }
}</pre>
                    </div>
                </div>

                <div class="config-section">
                    <h3>3. WebSocket ä»£ç†é…ç½®</h3>
                    <div class="config-example">
                        <pre>upstream websocket {
    server 127.0.0.1:8080;
}

server {
    listen 80;
    server_name ws.example.com;
    
    location /ws/ {
        proxy_pass http://websocket;
        proxy_http_version 1.1;
        
        # WebSocket å¿…éœ€é…ç½®
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        
        # é•¿è¶…æ—¶ï¼ˆWebSocket é•¿è¿æ¥ï¼‰
        proxy_read_timeout 86400s;
        proxy_send_timeout 86400s;
    }
}</pre>
                    </div>
                    <div class="note-box">
                        <strong>ğŸ’¡ WebSocket é…ç½®è¦ç‚¹ï¼š</strong> å¿…é¡»è®¾ç½® <code>Upgrade</code> å’Œ <code>Connection</code> å¤´ï¼Œä½¿ç”¨ HTTP/1.1ï¼Œè®¾ç½®é•¿è¶…æ—¶æ—¶é—´
                    </div>
                </div>

                <div class="config-section">
                    <h3>4. è·¯å¾„æ˜ å°„é…ç½®</h3>
                    <div class="config-example">
                        <pre>server {
    listen 80;
    server_name example.com;
    
    # /api/ ä»£ç†åˆ°åç«¯æœåŠ¡
    location /api/ {
        proxy_pass http://backend:8080/;  # æ³¨æ„æœ«å°¾çš„ /
        proxy_set_header Host $host;
    }
    
    # /app/ ä»£ç†åˆ°å¦ä¸€ä¸ªæœåŠ¡
    location /app/ {
        proxy_pass http://app-server:3000/app/;
    }
    
    # æ ¹è·¯å¾„ä»£ç†
    location / {
        proxy_pass http://frontend:80;
    }
}</pre>
                    </div>
                    <div class="warning-box">
                        <strong>âš ï¸ æ³¨æ„ï¼š</strong> <code>proxy_pass</code> æœ«å°¾çš„ <code>/</code> ä¼šå»æ‰ location åŒ¹é…çš„éƒ¨åˆ†ã€‚å¦‚ <code>location /api/</code> é… <code>proxy_pass http://backend/</code>ï¼Œåˆ™ <code>/api/test</code> ä¼šè½¬ä¸º <code>/test</code>
                    </div>
                </div>
            </div>
        </section>

        <!-- é™æ€æ–‡ä»¶æœåŠ¡ -->
        <section class="section">
            <div class="container">
                <h2 class="section-title">ğŸ“ é™æ€æ–‡ä»¶æœåŠ¡é…ç½®</h2>
                
                <div class="config-section">
                    <h3>1. åŸºç¡€é™æ€æ–‡ä»¶æœåŠ¡</h3>
                    <div class="config-example">
                        <pre>server {
    listen 80;
    server_name static.example.com;
    
    root /var/www/html;
    index index.html index.htm;
    
    location / {
        try_files $uri $uri/ =404;
    }
}</pre>
                    </div>
                </div>

                <div class="config-section">
                    <h3>2. é™æ€æ–‡ä»¶ä¼˜åŒ–é…ç½®</h3>
                    <div class="config-example">
                        <pre>server {
    listen 80;
    server_name static.example.com;
    
    root /var/www/static;
    
    # å¯ç”¨ sendfile é›¶æ‹·è´
    sendfile on;
    tcp_nopush on;
    tcp_nodelay on;
    
    # æ–‡ä»¶ç¼“å­˜
    open_file_cache max=10000 inactive=20s;
    open_file_cache_valid 60s;
    open_file_cache_min_uses 2;
    
    # é€šç”¨ä½ç½®é…ç½®
    location / {
        try_files $uri $uri/ =404;
    }
    
    # å›¾ç‰‡æ–‡ä»¶ - é•¿æœŸç¼“å­˜
    location ~* \.(jpg|jpeg|png|gif|ico|svg|webp)$ {
        expires 30d;
        add_header Cache-Control "public, immutable";
        access_log off;
    }
    
    # CSS/JS æ–‡ä»¶ - é•¿æœŸç¼“å­˜
    location ~* \.(css|js)$ {
        expires 7d;
        add_header Cache-Control "public";
        access_log off;
    }
    
    # å­—ä½“æ–‡ä»¶ - é•¿æœŸç¼“å­˜
    location ~* \.(woff|woff2|ttf|otf|eot)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
        access_log off;
    }
    
    # ç¦æ­¢è®¿é—®éšè—æ–‡ä»¶
    location ~ /\. {
        deny all;
        access_log off;
        log_not_found off;
    }
}</pre>
                    </div>
                    <div class="tip-box">
                        <strong>âœ… ä¼˜åŒ–è¦ç‚¹ï¼š</strong> å¯ç”¨ sendfileã€è®¾ç½®åˆç†çš„ç¼“å­˜æ—¶é—´ã€å…³é—­é™æ€æ–‡ä»¶è®¿é—®æ—¥å¿—ã€ç¦æ­¢è®¿é—®éšè—æ–‡ä»¶
                    </div>
                </div>

                <div class="config-section">
                    <h3>3. ç›®å½•åˆ—è¡¨é…ç½®</h3>
                    <div class="config-example">
                        <pre>server {
    listen 80;
    server_name files.example.com;
    
    location /downloads/ {
        alias /var/www/downloads/;
        autoindex on;              # å¯ç”¨ç›®å½•åˆ—è¡¨
        autoindex_exact_size off;  # æ˜¾ç¤ºäººç±»å¯è¯»çš„æ–‡ä»¶å¤§å°
        autoindex_format html;     # è¾“å‡ºæ ¼å¼ï¼ˆhtml/xml/json/textï¼‰
        autoindex_localtime on;    # æ˜¾ç¤ºæœ¬åœ°æ—¶é—´
    }
}</pre>
                    </div>
                </div>

                <div class="config-section">
                    <h3>4. é˜²ç›—é“¾é…ç½®</h3>
                    <div class="config-example">
                        <pre>server {
    listen 80;
    server_name images.example.com;
    
    root /var/www/images;
    
    location ~* \.(jpg|jpeg|png|gif|svg)$ {
        # å¯ç”¨é˜²ç›—é“¾
        valid_referers none blocked server_names *.example.com example.com;
        
        if ($invalid_referer) {
            return 403;
            # æˆ–è¿”å›é»˜è®¤å›¾ç‰‡ï¼šrewrite ^/ /default.png break;
        }
        
        expires 30d;
    }
}</pre>
                    </div>
                    <div class="note-box">
                        <strong>ğŸ’¡ valid_referers è¯´æ˜ï¼š</strong>
                        <ul>
                            <li><code>none</code> - å…è®¸ Referer å¤´ç¼ºå¤±çš„è¯·æ±‚</li>
                            <li><code>blocked</code> - å…è®¸ Referer è¢«é˜²ç«å¢™åˆ é™¤çš„è¯·æ±‚</li>
                            <li><code>server_names</code> - å…è®¸å½“å‰æœåŠ¡å™¨çš„åŸŸå</li>
                            <li>å…¶ä»–åŸŸå - æ˜ç¡®å…è®¸çš„åŸŸååˆ—è¡¨</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <!-- ç¼“å­˜é…ç½® -->
        <section class="section">
            <div class="container">
                <h2 class="section-title">ğŸ’¾ ç¼“å­˜é…ç½®</h2>
                
                <div class="config-section">
                    <h3>1. ä»£ç†ç¼“å­˜é…ç½®</h3>
                    <div class="config-example">
                        <pre># å®šä¹‰ç¼“å­˜è·¯å¾„ï¼ˆhttp å—ä¸­ï¼‰
proxy_cache_path /var/cache/nginx levels=1:2 keys_zone=my_cache:100m 
                 max_size=10g inactive=60m use_temp_path=off;

server {
    listen 80;
    server_name cache.example.com;
    
    location / {
        proxy_pass http://backend:8080;
        
        # å¯ç”¨ç¼“å­˜
        proxy_cache my_cache;
        
        # ç¼“å­˜é”®
        proxy_cache_key $scheme$proxy_host$request_uri;
        
        # ç¼“å­˜æœ‰æ•ˆæœŸ
        proxy_cache_valid 200 301 302 10m;
        proxy_cache_valid 404 1m;
        
        # æ¡ä»¶ç¼“å­˜
        proxy_cache_min_uses 2;
        proxy_cache_use_stale error timeout updating http_500 http_502 http_503 http_504;
        
        # æ·»åŠ ç¼“å­˜çŠ¶æ€å¤´
        add_header X-Cache-Status $upstream_cache_status;
    }
}</pre>
                    </div>
                    <table class="param-table">
                        <tr><th>å‚æ•°</th><th>è¯´æ˜</th></tr>
                        <tr><td><code>levels=1:2</code></td><td>ç›®å½•å±‚çº§ç»“æ„ï¼Œé¿å…å•ç›®å½•æ–‡ä»¶è¿‡å¤š</td></tr>
                        <tr><td><code>keys_zone=my_cache:100m</code></td><td>å…±äº«å†…å­˜åŒºåŸŸåç§°å’Œå¤§å°</td></tr>
                        <tr><td><code>max_size=10g</code></td><td>ç¼“å­˜æœ€å¤§å®¹é‡</td></tr>
                        <tr><td><code>inactive=60m</code></td><td>æœªè®¿é—®å†…å®¹çš„ä¿ç•™æ—¶é—´</td></tr>
                        <tr><td><code>use_temp_path=off</code></td><td>ç›´æ¥å†™å…¥ç›®æ ‡ä½ç½®ï¼Œä¸ç»è¿‡ä¸´æ—¶æ–‡ä»¶</td></tr>
                    </table>
                </div>

                <div class="config-section">
                    <h3>2. æµè§ˆå™¨ç¼“å­˜é…ç½®</h3>
                    <div class="config-example">
                        <pre>server {
    listen 80;
    server_name static.example.com;
    
    root /var/www/static;
    
    # å¼ºç¼“å­˜ï¼ˆ30 å¤©ï¼‰
    location ~* \.(jpg|jpeg|png|gif|ico|svg|webp|woff|woff2)$ {
        expires 30d;
        add_header Cache-Control "public, immutable";
    }
    
    # åå•†ç¼“å­˜ï¼ˆ7 å¤©ï¼‰
    location ~* \.(css|js)$ {
        expires 7d;
        add_header Cache-Control "public, must-revalidate";
    }
    
    # HTML æ–‡ä»¶ - ä¸ç¼“å­˜
    location ~* \.html$ {
        expires -1;
        add_header Cache-Control "no-cache, no-store, must-revalidate";
    }
    
    # API å“åº” - ä¸ç¼“å­˜
    location /api/ {
        add_header Cache-Control "no-store, no-cache, must-revalidate, proxy-revalidate";
        proxy_pass http://backend;
    }
}</pre>
                    </div>
                    <div class="note-box">
                        <strong>ğŸ’¡ ç¼“å­˜ç±»å‹ï¼š</strong>
                        <ul>
                            <li><strong>å¼ºç¼“å­˜</strong> - ç›´æ¥ä½¿ç”¨æœ¬åœ°ç¼“å­˜ï¼Œä¸å‘é€è¯·æ±‚ï¼ˆExpires/Cache-Controlï¼‰</li>
                            <li><strong>åå•†ç¼“å­˜</strong> - å‘é€è¯·æ±‚éªŒè¯ç¼“å­˜æ˜¯å¦æœ‰æ•ˆï¼ˆLast-Modified/ETagï¼‰</li>
                        </ul>
                    </div>
                </div>

                <div class="config-section">
                    <h3>3. ç¼“å­˜æ¸…é™¤é…ç½®</h3>
                    <div class="config-example">
                        <pre># éœ€è¦ç¼–è¯‘æ—¶åŠ å…¥ ngx_cache_purge æ¨¡å—

proxy_cache_path /var/cache/nginx levels=1:2 keys_zone=my_cache:100m;

server {
    listen 80;
    server_name cache.example.com;
    
    # ç¼“å­˜æ¸…é™¤ä½ç½®
    location ~ /purge(/.*) {
        allow 127.0.0.1;
        allow 192.168.1.0/24;
        deny all;
        proxy_cache_purge my_cache $scheme$proxy_host$1;
    }
    
    location / {
        proxy_pass http://backend:8080;
        proxy_cache my_cache;
        proxy_cache_key $scheme$proxy_host$request_uri;
    }
}</pre>
                    </div>
                    <div class="tip-box">
                        <strong>âœ… ä½¿ç”¨æ–¹æ³•ï¼š</strong> <code>curl http://cache.example.com/purge/api/data</code> æ¸…é™¤æŒ‡å®š URL çš„ç¼“å­˜
                    </div>
                </div>
            </div>
        </section>

        <!-- å®‰å…¨é…ç½® -->
        <section class="section">
            <div class="container">
                <h2 class="section-title">ğŸ›¡ï¸ å®‰å…¨é…ç½®</h2>
                
                <div class="config-section">
                    <h3>1. IP è®¿é—®æ§åˆ¶</h3>
                    <div class="config-example">
                        <pre>server {
    listen 80;
    server_name admin.example.com;
    
    location /admin/ {
        # åªå…è®¸ç‰¹å®š IP è®¿é—®
        allow 192.168.1.0/24;
        allow 10.0.0.0/8;
        deny all;
        
        proxy_pass http://backend;
    }
    
    # ç¦æ­¢è®¿é—®ç‰¹å®šä½ç½®
    location ~* /(config|backup|temp)/ {
        deny all;
        return 404;
    }
}</pre>
                    </div>
                </div>

                <div class="config-section">
                    <h3>2. è¯·æ±‚é™åˆ¶é…ç½®</h3>
                    <div class="config-example">
                        <pre>http {
    # å®šä¹‰é™æµåŒºåŸŸ
    # $binary_remote_addr - æŒ‰å®¢æˆ·ç«¯ IP
    # zone=one:10m - åŒºåŸŸåç§°å’Œå¤§å°
    # rate=10r/s - æ¯ç§’ 10 ä¸ªè¯·æ±‚
    limit_req_zone $binary_remote_addr zone=one:10m rate=10r/s;
    limit_req_zone $binary_remote_addr zone=api:10m rate=5r/s;
    
    # å®šä¹‰è¿æ¥é™åˆ¶åŒºåŸŸ
    limit_conn_zone $binary_remote_addr zone=addr:10m;
}

server {
    listen 80;
    server_name example.com;
    
    location / {
        # è¯·æ±‚é™æµ
        limit_req zone=one burst=20 nodelay;
        
        # è¿æ¥é™æµ
        limit_conn addr 10;
        
        # é™æµçŠ¶æ€ç 
        limit_req_status 429;
        limit_conn_status 429;
        
        proxy_pass http://backend;
    }
    
    location /api/ {
        # API æ›´ä¸¥æ ¼çš„é™æµ
        limit_req zone=api burst=5 nodelay;
        proxy_pass http://backend;
    }
}</pre>
                    </div>
                    <table class="param-table">
                        <tr><th>å‚æ•°</th><th>è¯´æ˜</th></tr>
                        <tr><td><code>burst=20</code></td><td>çªå‘è¯·æ±‚ç¼“å†²åŒºå¤§å°</td></tr>
                        <tr><td><code>nodelay</code></td><td>ç«‹å³å¤„ç†çªå‘è¯·æ±‚ï¼Œä¸å»¶è¿Ÿ</td></tr>
                        <tr><td><code>limit_req_status 429</code></td><td>é™æµè¿”å›çš„çŠ¶æ€ç </td></tr>
                    </table>
                </div>

                <div class="config-section">
                    <h3>3. HTTP åŸºæœ¬è®¤è¯</h3>
                    <div class="config-example">
                        <pre>server {
    listen 80;
    server_name secure.example.com;
    
    location /secure/ {
        auth_basic "Restricted Area";
        auth_basic_user_file /etc/nginx/.htpasswd;
        
        proxy_pass http://backend;
    }
}</pre>
                    </div>
                    <div class="tip-box">
                        <strong>âœ… åˆ›å»ºå¯†ç æ–‡ä»¶ï¼š</strong>
                        <pre># åˆ›å»ºç¬¬ä¸€ä¸ªç”¨æˆ·
htpasswd -c /etc/nginx/.htpasswd username

# æ·»åŠ æ›´å¤šç”¨æˆ·
htpasswd /etc/nginx/.htpasswd username2</pre>
                    </div>
                </div>

                <div class="config-section">
                    <h3>4. å®‰å…¨å“åº”å¤´é…ç½®</h3>
                    <div class="config-example">
                        <pre>server {
    listen 443 ssl http2;
    server_name example.com;
    
    # SSL é…ç½®...
    
    # å®‰å…¨å“åº”å¤´
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header X-XSS-Protection "1; mode=block" always;
    add_header Referrer-Policy "strict-origin-when-cross-origin" always;
    add_header Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline';" always;
    add_header Permissions-Policy "geolocation=(), microphone=(), camera=()" always;
    add_header Strict-Transport-Security "max-age=63072000; includeSubDomains; preload" always;
    
    # éšè— Nginx ç‰ˆæœ¬å·
    server_tokens off;
    
    location / {
        proxy_pass http://backend;
    }
}</pre>
                    </div>
                </div>
            </div>
        </section>

        <!-- æ€§èƒ½ä¼˜åŒ–é…ç½® -->
        <section class="section">
            <div class="container">
                <h2 class="section-title">âš¡ æ€§èƒ½ä¼˜åŒ–é…ç½®</h2>
                
                <div class="config-section">
                    <h3>1. å…¨å±€æ€§èƒ½ä¼˜åŒ–</h3>
                    <div class="config-example">
                        <pre># nginx.conf
user nginx;
worker_processes auto;  # è‡ªåŠ¨æ£€æµ‹ CPU æ ¸å¿ƒæ•°
worker_rlimit_nofile 65535;

error_log /var/log/nginx/error.log warn;
pid /var/run/nginx.pid;

events {
    use epoll;
    worker_connections 65535;
    multi_accept on;
    accept_mutex off;
}

http {
    include /etc/nginx/mime.types;
    default_type application/octet-stream;
    
    # æ—¥å¿—æ ¼å¼ä¼˜åŒ–
    log_format main '$remote_addr - $remote_user [$time_local] "$request" '
                    '$status $body_bytes_sent "$http_referer" '
                    '"$http_user_agent" "$http_x_forwarded_for" '
                    '$request_time $upstream_response_time';
    
    access_log /var/log/nginx/access.log main;
    
    # æ€§èƒ½ä¼˜åŒ–
    sendfile on;
    tcp_nopush on;
    tcp_nodelay on;
    
    # è¿æ¥ä¼˜åŒ–
    keepalive_timeout 65;
    keepalive_requests 1000;
    keepalive_time 1h;
    
    # æ–‡ä»¶ç¼“å­˜
    open_file_cache max=10000 inactive=20s;
    open_file_cache_valid 60s;
    open_file_cache_min_uses 2;
    
    # Gzip å‹ç¼©
    gzip on;
    gzip_vary on;
    gzip_proxied any;
    gzip_comp_level 6;
    gzip_types text/plain text/css text/xml application/json application/javascript 
               application/xml application/rss+xml application/atom+xml image/svg+xml;
}</pre>
                    </div>
                </div>

                <div class="config-section">
                    <h3>2. Gzip å‹ç¼©é…ç½®</h3>
                    <div class="config-example">
                        <pre>http {
    gzip on;
    gzip_vary on;
    gzip_proxied any;
    gzip_comp_level 6;  # å‹ç¼©çº§åˆ« 1-9
    gzip_min_length 1000;  # æœ€å°å‹ç¼©é•¿åº¦
    
    # å‹ç¼©ç±»å‹
    gzip_types 
        text/plain
        text/css
        text/xml
        application/json
        application/javascript
        application/xml
        application/rss+xml
        application/atom+xml
        image/svg+xml
        font/woff
        font/woff2;
    
    # ç¦ç”¨å‹ç¼©çš„æµè§ˆå™¨
    gzip_disable "msie6";
    
    # ç¼“å†²é…ç½®
    gzip_buffers 16 8k;
    gzip_http_version 1.1;
}</pre>
                    </div>
                    <div class="warning-box">
                        <strong>âš ï¸ æ³¨æ„ï¼š</strong> å›¾ç‰‡ã€è§†é¢‘ç­‰å·²å‹ç¼©æ ¼å¼ä¸éœ€è¦ gzipï¼Œå·²å‹ç¼©çš„æ–‡ä»¶å†å‹ç¼©ä¼šæµªè´¹ CPU ä¸”æ•ˆæœç”šå¾®
                    </div>
                </div>

                <div class="config-section">
                    <h3>3. FastCGI ä¼˜åŒ–ï¼ˆPHPï¼‰</h3>
                    <div class="config-example">
                        <pre>server {
    listen 80;
    server_name php.example.com;
    root /var/www/html;
    
    location ~ \.php$ {
        fastcgi_pass unix:/run/php/php-fpm.sock;
        fastcgi_index index.php;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        include fastcgi_params;
        
        # ç¼“å†²é…ç½®
        fastcgi_buffering on;
        fastcgi_buffer_size 4k;
        fastcgi_buffers 8 4k;
        fastcgi_busy_buffers_size 8k;
        
        # è¶…æ—¶é…ç½®
        fastcgi_connect_timeout 60s;
        fastcgi_send_timeout 60s;
        fastcgi_read_timeout 60s;
        
        # ä¸´æ—¶æ–‡ä»¶
        fastcgi_max_temp_file_size 1024m;
        fastcgi_temp_file_write_size 2k;
        
        # ç¼“å­˜é…ç½®
        fastcgi_cache my_cache;
        fastcgi_cache_valid 200 302 10m;
        fastcgi_cache_valid 404 1m;
        fastcgi_cache_min_uses 2;
        fastcgi_cache_use_stale error timeout updating http_500 http_502 http_503 http_504;
        fastcgi_cache_key $scheme$host$request_uri;
        
        # ç¼“å­˜çŠ¶æ€å¤´
        add_header X-Fastcgi-Cache $upstream_cache_status;
    }
}</pre>
                    </div>
                </div>
            </div>
        </section>

        <!-- å®Œæ•´ç¤ºä¾‹ -->
        <section class="section">
            <div class="container">
                <h2 class="section-title">ğŸ“‹ å®Œæ•´é…ç½®ç¤ºä¾‹</h2>
                
                <div class="scenario-card">
                    <h4>ğŸ¯ åœºæ™¯ï¼šç”Ÿäº§ç¯å¢ƒ Web åº”ç”¨å®Œæ•´é…ç½®</h4>
                </div>

                <div class="config-example">
                    <pre># /etc/nginx/nginx.conf
user nginx;
worker_processes auto;
worker_rlimit_nofile 65535;
error_log /var/log/nginx/error.log warn;
pid /var/run/nginx.pid;

events {
    use epoll;
    worker_connections 65535;
    multi_accept on;
    accept_mutex off;
}

http {
    include /etc/nginx/mime.types;
    default_type application/octet-stream;
    
    # æ—¥å¿—æ ¼å¼
    log_format main '$remote_addr - $remote_user [$time_local] "$request" '
                    '$status $body_bytes_sent "$http_referer" '
                    '"$http_user_agent" "$http_x_forwarded_for" '
                    'rt=$request_time uct="$upstream_connect_time" '
                    'uht="$upstream_header_time" urt="$upstream_response_time"';
    
    access_log /var/log/nginx/access.log main;
    
    # åŸºç¡€ä¼˜åŒ–
    sendfile on;
    tcp_nopush on;
    tcp_nodelay on;
    keepalive_timeout 65;
    keepalive_requests 1000;
    
    # Gzip å‹ç¼©
    gzip on;
    gzip_vary on;
    gzip_proxied any;
    gzip_comp_level 6;
    gzip_types text/plain text/css application/json application/javascript text/xml application/xml;
    
    # é™æµåŒºåŸŸ
    limit_req_zone $binary_remote_addr zone=one:10m rate=10r/s;
    limit_conn_zone $binary_remote_addr zone=addr:10m;
    
    # ä»£ç†ç¼“å­˜
    proxy_cache_path /var/cache/nginx levels=1:2 keys_zone=my_cache:100m max_size=10g inactive=60m;
    
    # åŒ…å«å…¶ä»–é…ç½®
    include /etc/nginx/conf.d/*.conf;
}</pre>
                </div>

                <div class="config-example">
                    <pre># /etc/nginx/conf.d/app.conf
upstream backend {
    least_conn;
    server 127.0.0.1:8001 weight=3 max_fails=3 fail_timeout=30s;
    server 127.0.0.1:8002 weight=2 max_fails=3 fail_timeout=30s;
    server 127.0.0.1:8003 weight=1 max_fails=3 fail_timeout=30s;
    keepalive 32;
}

# HTTP æœåŠ¡å™¨ - å¼ºåˆ¶è·³è½¬ HTTPS
server {
    listen 80;
    server_name example.com www.example.com;
    return 301 https://$host$request_uri;
}

# HTTPS æœåŠ¡å™¨
server {
    listen 443 ssl http2;
    server_name example.com www.example.com;
    
    # SSL é…ç½®
    ssl_certificate /etc/nginx/ssl/fullchain.pem;
    ssl_certificate_key /etc/nginx/ssl/privkey.pem;
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384;
    ssl_prefer_server_ciphers off;
    ssl_session_cache shared:SSL:10m;
    ssl_session_timeout 1d;
    ssl_session_tickets off;
    
    # OCSP Stapling
    ssl_stapling on;
    ssl_stapling_verify on;
    
    # å®‰å…¨å¤´
    add_header Strict-Transport-Security "max-age=63072000; includeSubDomains; preload" always;
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header X-XSS-Protection "1; mode=block" always;
    add_header Referrer-Policy "strict-origin-when-cross-origin" always;
    
    # éšè—ç‰ˆæœ¬å·
    server_tokens off;
    
    # é™æ€æ–‡ä»¶
    location /static/ {
        alias /var/www/static/;
        expires 30d;
        add_header Cache-Control "public, immutable";
        access_log off;
    }
    
    # ä¸»åº”ç”¨
    location / {
        # é™æµ
        limit_req zone=one burst=20 nodelay;
        limit_conn addr 10;
        
        # ä»£ç†é…ç½®
        proxy_pass http://backend;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header Connection "";
        
        # è¶…æ—¶
        proxy_connect_timeout 60s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;
        
        # ç¼“å†²
        proxy_buffering on;
        proxy_buffer_size 4k;
        proxy_buffers 8 4k;
        proxy_busy_buffers_size 8k;
        
        # é‡è¯•
        proxy_next_upstream error timeout http_502 http_503 http_504;
        proxy_next_upstream_tries 3;
    }
    
    # API æ¥å£
    location /api/ {
        limit_req zone=one burst=5 nodelay;
        
        proxy_pass http://backend;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header Connection "";
        
        # ä¸ç¼“å­˜ API å“åº”
        proxy_no_cache 1;
        proxy_cache_bypass 1;
    }
    
    # WebSocket
    location /ws/ {
        proxy_pass http://backend;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_set_header Host $host;
        proxy_read_timeout 86400s;
    }
}</pre>
                </div>
            </div>
        </section>
    </main>
    
    <script>
        // é…ç½®æŠ˜å åŠŸèƒ½
        document.addEventListener('DOMContentLoaded', function() {
            // è·å–æ‰€æœ‰ config-section
            const sections = document.querySelectorAll('.config-section');
            
            // é»˜è®¤å…¨éƒ¨æŠ˜å 
            sections.forEach(function(section) {
                section.classList.add('collapsed');
                
                // åŒ…è£…å†…å®¹åˆ° config-content div
                const h3 = section.querySelector('h3');
                if (h3) {
                    let next = h3.nextElementSibling;
                    const contentDiv = document.createElement('div');
                    contentDiv.className = 'config-content';
                    
                    // å°†æ‰€æœ‰åç»­å…ƒç´ ç§»åˆ° contentDiv ä¸­ï¼Œç›´åˆ°ä¸‹ä¸€ä¸ª h3 æˆ– section ç»“æŸ
                    while (next && next.tagName !== 'H3') {
                        contentDiv.appendChild(next.cloneNode(true));
                        next = next.nextElementSibling;
                    }
                    
                    // æ¸…ç©ºåŸå†…å®¹å¹¶æ·»åŠ  contentDiv
                    while (section.childNodes.length > 1) {
                        if (section.lastChild !== h3) {
                            section.removeChild(section.lastChild);
                        } else {
                            break;
                        }
                    }
                    section.appendChild(contentDiv);
                    
                    // æ·»åŠ ç‚¹å‡»äº‹ä»¶
                    h3.addEventListener('click', function() {
                        section.classList.toggle('collapsed');
                    });
                }
            });
            
            // æ·»åŠ å…¨éƒ¨å±•å¼€/æŠ˜å æŒ‰é’®
            const mainElement = document.querySelector('main');
            const toggleContainer = document.createElement('div');
            toggleContainer.style.cssText = 'text-align: right; padding: 10px 20px; background: #f8f9fa; margin-bottom: 20px; border-radius: 4px;';
            toggleContainer.innerHTML = `
                <button onclick="expandAll()" style="padding: 8px 16px; margin-left: 10px; cursor: pointer; border: 1px solid #007acc; background: white; color: #007acc; border-radius: 4px;">å…¨éƒ¨å±•å¼€</button>
                <button onclick="collapseAll()" style="padding: 8px 16px; margin-left: 10px; cursor: pointer; border: 1px solid #007acc; background: white; color: #007acc; border-radius: 4px;">å…¨éƒ¨æŠ˜å </button>
            `;
            mainElement.insertBefore(toggleContainer, mainElement.firstChild);
        });
        
        function expandAll() {
            const sections = document.querySelectorAll('.config-section');
            sections.forEach(function(section) {
                section.classList.remove('collapsed');
            });
        }
        
        function collapseAll() {
            const sections = document.querySelectorAll('.config-section');
            sections.forEach(function(section) {
                section.classList.add('collapsed');
            });
        }
    </script>
</body>
</html>
