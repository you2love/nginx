<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nginx å†…éƒ¨æœºåˆ¶ - æ¶æ„ä¸è®¾è®¡</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .flow-container {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 8px;
            margin: 20px 0;
            overflow-x: auto;
        }
        .flow-diagram {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
        }
        .flow-box {
            background: white;
            border: 2px solid #007acc;
            border-radius: 8px;
            padding: 15px;
            min-width: 120px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .flow-box.master {
            background: #e8f5e9;
            border-color: #2e7d32;
        }
        .flow-box.worker {
            background: #e3f2fd;
            border-color: #1976d2;
        }
        .flow-box.module {
            background: #fff3e0;
            border-color: #f57c00;
        }
        .flow-arrow {
            color: #666;
            font-size: 24px;
        }
        .architecture-diagram {
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            overflow-x: auto;
        }
        .architecture-diagram pre {
            margin: 0;
            font-size: 13px;
            line-height: 1.8;
            font-family: 'Courier New', monospace;
        }
        .phase-detail {
            background: white;
            border-left: 4px solid #007acc;
            padding: 20px;
            margin: 20px 0;
            border-radius: 4px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        .phase-detail h4 {
            color: #007acc;
            margin-top: 0;
        }
        .note-box {
            background: #d1ecf1;
            border-left: 4px solid #17a2b8;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
        }
        .warning-box {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
        }
        .info-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        .info-table th, .info-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        .info-table th {
            background: #f8f9fa;
            font-weight: bold;
        }
        .info-table code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
        }
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        .comparison-table th, .comparison-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        .comparison-table th {
            background: #f8f9fa;
            font-weight: bold;
        }
        .highlight-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .highlight-box pre {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
        }
        .highlight-box code {
            background: rgba(255,255,255,0.2);
            padding: 2px 6px;
            border-radius: 3px;
        }
        .module-tree {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            overflow-x: auto;
        }
        .module-tree pre {
            margin: 0;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.6;
            color: #333;
        }
        .sequence-diagram {
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            overflow-x: auto;
        }
        .sequence-diagram pre {
            margin: 0;
            font-size: 13px;
            line-height: 1.6;
        }
        .memory-layout {
            background: #263238;
            color: #aed581;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.8;
        }
        .timeline {
            position: relative;
            padding-left: 30px;
            margin: 20px 0;
        }
        .timeline-item {
            position: relative;
            padding-bottom: 20px;
            border-left: 2px solid #007acc;
            padding-left: 20px;
        }
        .timeline-item::before {
            content: '';
            position: absolute;
            left: -6px;
            top: 0;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #007acc;
        }
        .timeline-item h4 {
            margin: 0 0 5px 0;
            color: #007acc;
        }
        .timeline-item p {
            margin: 0;
            color: #666;
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="container">
            <div class="logo">
                <h1>Nginx æ·±åº¦å­¦ä¹ </h1>
                <p class="tagline">æ­ç§˜å†…éƒ¨æœºåˆ¶ï¼ŒæŒæ¡æ ¸å¿ƒé…ç½®</p>
            </div>
            <nav class="nav">
                <a href="index.html" class="nav-link">é¦–é¡µ</a>
                <a href="mechanism.html" class="nav-link active">å†…éƒ¨æœºåˆ¶</a>
                <a href="request-flow.html" class="nav-link">è¯·æ±‚å¤„ç†</a>
                <a href="directives.html" class="nav-link">æŒ‡ä»¤è¯¦è§£</a>
                <a href="configs.html" class="nav-link">åº”ç”¨é…ç½®</a>
                <a href="debug.html" class="nav-link">æ—¥å¿—è°ƒè¯•</a>
                <a href="tools.html" class="nav-link">å‘¨è¾¹å·¥å…·</a>
                <a href="modules.html" class="nav-link">æ’ä»¶ç³»ç»Ÿ</a>
            </nav>
        </div>
    </header>

    <main>
        <section class="section">
            <div class="container">
                <h2 class="section-title">ğŸ—ï¸ Master-Worker æ¶æ„</h2>
                
                <div class="architecture-diagram">
                    <pre>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Master Process                          â”‚
â”‚                        (ä¸»è¿›ç¨‹ - ç®¡ç†å‘˜)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚ è¯»å–é…ç½®    â”‚  â”‚ ç®¡ç† Worker â”‚  â”‚ å¹³æ»‘é‡å¯    â”‚             â”‚
â”‚  â”‚ éªŒè¯é…ç½®    â”‚  â”‚ è¿›ç¨‹çŠ¶æ€    â”‚  â”‚ çƒ­å‡çº§      â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚               â”‚               â”‚
              â–¼               â–¼               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Worker Process â”‚ â”‚   Worker Process â”‚ â”‚   Worker Process â”‚
â”‚      (å·¥ä½œè¿›ç¨‹)   â”‚ â”‚      (å·¥ä½œè¿›ç¨‹)   â”‚ â”‚      (å·¥ä½œè¿›ç¨‹)   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Event Loop â”‚  â”‚ â”‚  â”‚ Event Loop â”‚  â”‚ â”‚  â”‚ Event Loop â”‚  â”‚
â”‚  â”‚ äº‹ä»¶å¾ªç¯    â”‚  â”‚ â”‚  â”‚ äº‹ä»¶å¾ªç¯    â”‚  â”‚ â”‚  â”‚ äº‹ä»¶å¾ªç¯    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚        â”‚         â”‚ â”‚        â”‚         â”‚ â”‚        â”‚         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ å¤„ç†è¿æ¥   â”‚  â”‚ â”‚  â”‚ å¤„ç†è¿æ¥   â”‚  â”‚ â”‚  â”‚ å¤„ç†è¿æ¥   â”‚  â”‚
â”‚  â”‚ å¤„ç†è¯·æ±‚   â”‚  â”‚ â”‚  â”‚ å¤„ç†è¯·æ±‚   â”‚  â”‚ â”‚  â”‚ å¤„ç†è¯·æ±‚   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                    â”‚                    â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚              â”‚              â”‚
              â–¼              â–¼              â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ å®¢æˆ·ç«¯ â”‚    â”‚ åç«¯   â”‚    â”‚ æ–‡ä»¶ç³»ç»Ÿâ”‚
         â”‚ Clientsâ”‚    â”‚ Server â”‚    â”‚ Files  â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    </pre>
                </div>

                <div class="note-box">
                    <strong>ğŸ’¡ æ¶æ„ç‰¹ç‚¹ï¼š</strong>
                    <ul>
                        <li><strong>Master è¿›ç¨‹</strong> - ä¸å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚ï¼Œåªè´Ÿè´£ç®¡ç†èŒè´£</li>
                        <li><strong>Worker è¿›ç¨‹</strong> - å¯¹ç­‰å…³ç³»ï¼Œç‹¬ç«‹å¤„ç†è¯·æ±‚ï¼Œæ— å…±äº«çŠ¶æ€</li>
                        <li><strong>äº‹ä»¶é©±åŠ¨</strong> - æ¯ä¸ª Worker ä½¿ç”¨å¼‚æ­¥éé˜»å¡ I/O</li>
                        <li><strong>æ— é”è®¾è®¡</strong> - è¿›ç¨‹é—´æ— éœ€é”ï¼Œå‡å°‘ä¸Šä¸‹æ–‡åˆ‡æ¢</li>
                    </ul>
                </div>

                <h3 class="section-subtitle">Master è¿›ç¨‹èŒè´£</h3>
                <table class="info-table">
                    <thead>
                        <tr><th>èŒè´£</th><th>è¯´æ˜</th><th>è§¦å‘æ¡ä»¶</th></tr>
                    </thead>
                    <tbody>
                        <tr><td>è¯»å–å’ŒéªŒè¯é…ç½®</td><td>è¯»å– nginx.conf å¹¶éªŒè¯è¯­æ³•</td><td>å¯åŠ¨/é‡è½½é…ç½®</td></tr>
                        <tr><td>ç»‘å®šç«¯å£</td><td>åˆ›å»ºç›‘å¬å¥—æ¥å­—</td><td>å¯åŠ¨/çƒ­å‡çº§</td></tr>
                        <tr><td>ç®¡ç† Worker</td><td>å¯åŠ¨ã€åœæ­¢ã€é‡å¯ Worker è¿›ç¨‹</td><td>å¯åŠ¨/é…ç½®å˜æ›´</td></tr>
                        <tr><td>å¹³æ»‘é‡å¯</td><td>å‘é€ä¿¡å·é‡æ–°åŠ è½½é…ç½®</td><td>HUP ä¿¡å·</td></tr>
                        <tr><td>çƒ­å‡çº§</td><td>ä¸ä¸­æ–­æœåŠ¡å‡çº§ Nginx äºŒè¿›åˆ¶</td><td>USR2 ä¿¡å·</td></tr>
                        <tr><td>æ—¥å¿—è½®è½¬</td><td>é‡æ–°æ‰“å¼€æ—¥å¿—æ–‡ä»¶</td><td>USR1 ä¿¡å·</td></tr>
                    </tbody>
                </table>

                <h3 class="section-subtitle">Worker è¿›ç¨‹èŒè´£</h3>
                <table class="info-table">
                    <thead>
                        <tr><th>èŒè´£</th><th>è¯´æ˜</th><th>ç‰¹ç‚¹</th></tr>
                    </thead>
                    <tbody>
                        <tr><td>å¤„ç†è¿æ¥</td><td>æ¥å—å¹¶å¤„ç†å®¢æˆ·ç«¯è¿æ¥</td><td>å¼‚æ­¥éé˜»å¡</td></tr>
                        <tr><td>æ‰§è¡Œæ¨¡å—é€»è¾‘</td><td>è¿è¡Œ HTTPã€Stream ç­‰æ¨¡å—ä»£ç </td><td>æŒ‰é…ç½®æ‰§è¡Œ</td></tr>
                        <tr><td>I/O æ“ä½œ</td><td>è¯»å†™ç½‘ç»œã€æ–‡ä»¶ç³»ç»Ÿ</td><td>äº‹ä»¶é©±åŠ¨</td></tr>
                        <tr><td>ç¼“å­˜ç®¡ç†</td><td>ç®¡ç†ä»£ç†ç¼“å­˜ã€FastCGI ç¼“å­˜</td><td>è¿›ç¨‹å†…ç¼“å­˜</td></tr>
                        <tr><td>æ—¥å¿—è®°å½•</td><td>å†™å…¥è®¿é—®æ—¥å¿—å’Œé”™è¯¯æ—¥å¿—</td><td>ç¼“å†²å†™å…¥</td></tr>
                    </tbody>
                </table>
            </div>
        </section>

        <section class="section">
            <div class="container">
                <h2 class="section-title">ğŸ”„ äº‹ä»¶é©±åŠ¨æ¨¡å‹</h2>
                
                <div class="flow-container">
                    <div class="flow-diagram">
                        <div class="flow-box worker">
                            <strong>Worker è¿›ç¨‹</strong>
                            <br><small>å¯åŠ¨</small>
                        </div>
                        <div class="flow-arrow">â†’</div>
                        <div class="flow-box module">
                            <strong>åˆå§‹åŒ–</strong>
                            <br><small>åˆ›å»ºè¿æ¥æ± </small>
                        </div>
                        <div class="flow-arrow">â†’</div>
                        <div class="flow-box module">
                            <strong>æ³¨å†Œäº‹ä»¶</strong>
                            <br><small>ç›‘å¬å¥—æ¥å­—</small>
                        </div>
                        <div class="flow-arrow">â†’</div>
                        <div class="flow-box worker">
                            <strong>äº‹ä»¶å¾ªç¯</strong>
                            <br><small>Event Loop</small>
                        </div>
                    </div>
                </div>

                <div class="sequence-diagram">
                    <pre>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Client â”‚     â”‚ epoll    â”‚     â”‚ Worker  â”‚     â”‚ Backend â”‚     â”‚  File   â”‚
â”‚         â”‚     â”‚ (å†…æ ¸)   â”‚     â”‚         â”‚     â”‚ Server  â”‚     â”‚ System  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚                â”‚                â”‚                â”‚                â”‚
     â”‚ TCP Connect    â”‚                â”‚                â”‚                â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚                â”‚                â”‚
     â”‚                â”‚ EPOLLIN äº‹ä»¶   â”‚                â”‚                â”‚
     â”‚                â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚                â”‚
     â”‚                â”‚                â”‚                â”‚                â”‚
     â”‚                â”‚                â”‚ accept()       â”‚                â”‚
     â”‚                â”‚                â”‚ æ¥å—è¿æ¥       â”‚                â”‚
     â”‚                â”‚                â”‚                â”‚                â”‚
     â”‚ HTTP Request   â”‚                â”‚                â”‚                â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚                â”‚                â”‚
     â”‚                â”‚ EPOLLIN äº‹ä»¶   â”‚                â”‚                â”‚
     â”‚                â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚                â”‚
     â”‚                â”‚                â”‚                â”‚                â”‚
     â”‚                â”‚                â”‚ è¯»å–è¯·æ±‚       â”‚                â”‚
     â”‚                â”‚                â”‚ è§£æå¤´éƒ¨       â”‚                â”‚
     â”‚                â”‚                â”‚                â”‚                â”‚
     â”‚                â”‚                â”‚ åŒ¹é… location  â”‚                â”‚
     â”‚                â”‚                â”‚                â”‚                â”‚
     â”‚                â”‚                â”‚ proxy_pass     â”‚                â”‚
     â”‚                â”‚                â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚
     â”‚                â”‚                â”‚                â”‚                â”‚
     â”‚                â”‚ EPOLLOUT äº‹ä»¶  â”‚                â”‚                â”‚
     â”‚                â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                â”‚                â”‚
     â”‚                â”‚                â”‚                â”‚                â”‚
     â”‚                â”‚                â”‚ è¯»å–åç«¯å“åº”   â”‚                â”‚
     â”‚                â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                â”‚                â”‚
     â”‚                â”‚                â”‚                â”‚                â”‚
     â”‚ HTTP Response  â”‚                â”‚                â”‚                â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                â”‚                â”‚                â”‚
     â”‚                â”‚                â”‚                â”‚                â”‚
     â”‚                â”‚                â”‚ è®°å½•æ—¥å¿—       â”‚                â”‚
     â”‚                â”‚                â”‚ å…³é—­è¿æ¥       â”‚                â”‚
     â”‚                â”‚                â”‚                â”‚                â”‚
                    </pre>
                </div>

                <h3 class="section-subtitle">äº‹ä»¶å¤„ç†æµç¨‹</h3>
                <div class="timeline">
                    <div class="timeline-item">
                        <h4>1. äº‹ä»¶æ³¨å†Œ</h4>
                        <p>Worker å¯åŠ¨æ—¶ï¼Œå°†ç›‘å¬å¥—æ¥å­—æ³¨å†Œåˆ°äº‹ä»¶å¤šè·¯å¤ç”¨å™¨ï¼ˆepoll/kqueueï¼‰</p>
                    </div>
                    <div class="timeline-item">
                        <h4>2. äº‹ä»¶ç­‰å¾…</h4>
                        <p>è°ƒç”¨ <code>epoll_wait()</code> é˜»å¡ç­‰å¾…äº‹ä»¶å‘ç”Ÿï¼Œè¶…æ—¶æ—¶é—´ç”±é…ç½®å†³å®š</p>
                    </div>
                    <div class="timeline-item">
                        <h4>3. äº‹ä»¶åˆ†å‘</h4>
                        <p>äº‹ä»¶å‘ç”Ÿåï¼Œæ ¹æ®æ–‡ä»¶æè¿°ç¬¦æ‰¾åˆ°å¯¹åº”çš„è¿æ¥å’Œå›è°ƒå‡½æ•°</p>
                    </div>
                    <div class="timeline-item">
                        <h4>4. äº‹ä»¶å¤„ç†</h4>
                        <p>æ‰§è¡Œå›è°ƒå‡½æ•°å¤„ç†è¯·æ±‚ï¼Œå¯èƒ½æ˜¯è¯»å–ã€å†™å…¥æˆ–å…³é—­è¿æ¥</p>
                    </div>
                    <div class="timeline-item">
                        <h4>5. äº‹ä»¶å®Œæˆ</h4>
                        <p>å¤„ç†å®Œæˆåï¼Œå¯èƒ½æ³¨å†Œæ–°çš„äº‹ä»¶ï¼ˆå¦‚å†™äº‹ä»¶ï¼‰æˆ–å…³é—­è¿æ¥</p>
                    </div>
                </div>

                <h3 class="section-subtitle">äº‹ä»¶å¤šè·¯å¤ç”¨æ–¹æ³•å¯¹æ¯”</h3>
                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th>æ–¹æ³•</th>
                            <th>æ“ä½œç³»ç»Ÿ</th>
                            <th>æ€§èƒ½</th>
                            <th>ç‰¹ç‚¹</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>epoll</strong></td>
                            <td>Linux 2.6+</td>
                            <td>æœ€ä¼˜</td>
                            <td>çº¢é»‘æ ‘å­˜å‚¨ï¼ŒO(1) äº‹ä»¶æŸ¥æ‰¾ï¼Œæ”¯æŒè¾¹ç¼˜è§¦å‘</td>
                        </tr>
                        <tr>
                            <td><strong>kqueue</strong></td>
                            <td>FreeBSD, macOS</td>
                            <td>ä¼˜ç§€</td>
                            <td>BSD ç³»ç»ŸåŸç”Ÿï¼ŒåŠŸèƒ½ä¸°å¯Œ</td>
                        </tr>
                        <tr>
                            <td><strong>/dev/poll</strong></td>
                            <td>Solaris, AIX</td>
                            <td>è‰¯å¥½</td>
                            <td>å†…æ ¸çº§è½®è¯¢ï¼Œæ€§èƒ½ç¨³å®š</td>
                        </tr>
                        <tr>
                            <td><strong>poll</strong></td>
                            <td>è·¨å¹³å°</td>
                            <td>ä¸€èˆ¬</td>
                            <td>çº¿æ€§æ‰«æï¼Œè¿æ¥æ•°å¤šæ—¶æ€§èƒ½ä¸‹é™</td>
                        </tr>
                        <tr>
                            <td><strong>select</strong></td>
                            <td>è·¨å¹³å°</td>
                            <td>è¾ƒå·®</td>
                            <td>æœ‰æ–‡ä»¶æè¿°ç¬¦æ•°é‡é™åˆ¶ï¼ˆé€šå¸¸ 1024ï¼‰</td>
                        </tr>
                    </tbody>
                </table>

                <div class="highlight-box">
                    <strong>ğŸ’¡ é…ç½®å»ºè®®ï¼š</strong>
                    <pre>
# è‡ªåŠ¨é€‰æ‹©æœ€ä½³äº‹ä»¶æ–¹æ³•
events {
    use epoll;  # Linux ä¸‹æ¨èæ˜¾å¼æŒ‡å®š
    
    # æ¯ä¸ª Worker çš„æœ€å¤§è¿æ¥æ•°
    worker_connections 10240;
    
    # æ¥å—å¤šä¸ªè¿æ¥
    multi_accept on;
    
    # ä½¿ç”¨äº’æ–¥é”ï¼ˆé«˜å¹¶å‘æ—¶å»ºè®®å…³é—­ï¼‰
    accept_mutex off;
}</pre>
                </div>
            </div>
        </section>

        <section class="section">
            <div class="container">
                <h2 class="section-title">ğŸ§© æ¨¡å—ç³»ç»Ÿæ¶æ„</h2>
                
                <div class="module-tree">
<pre>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Nginx æ¨¡å—ç³»ç»Ÿæ¶æ„å›¾                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ã€æ ¸å¿ƒæ¨¡å— Core Modulesã€‘(å¿…é€‰ï¼Œæ— æ³•ç¦ç”¨)
â”œâ”€â”€ ngx_core_module          (æ ¸å¿ƒé…ç½®)
â”œâ”€â”€ ngx_errlog_module        (é”™è¯¯æ—¥å¿—)
â”œâ”€â”€ ngx_conf_module          (é…ç½®è§£æ)
â”œâ”€â”€ ngx_events_module        (äº‹ä»¶å¤„ç†)
â”œâ”€â”€ ngx_event_core_module    (äº‹ä»¶æ ¸å¿ƒ)
â”œâ”€â”€ ngx_regex_module         (æ­£åˆ™è¡¨è¾¾å¼)
â””â”€â”€ ngx_openssl_module       (SSL/TLS æ”¯æŒ)

ã€HTTP æ¨¡å— HTTP Modulesã€‘
â”œâ”€â”€ æ ‡å‡†æ¨¡å— (é»˜è®¤ç¼–è¯‘)
â”‚   â”œâ”€â”€ ngx_http_core_module         (HTTP æ ¸å¿ƒ)
â”‚   â”œâ”€â”€ ngx_http_upstream_module     (è´Ÿè½½å‡è¡¡)
â”‚   â”œâ”€â”€ ngx_http_proxy_module        (åå‘ä»£ç†)
â”‚   â”œâ”€â”€ ngx_http_fastcgi_module      (FastCGI)
â”‚   â”œâ”€â”€ ngx_http_gzip_module         (å‹ç¼©)
â”‚   â”œâ”€â”€ ngx_http_ssl_module          (HTTPS)
â”‚   â”œâ”€â”€ ngx_http_v2_module           (HTTP/2)
â”‚   â”œâ”€â”€ ngx_http_v3_module           (HTTP/3)
â”‚   â”œâ”€â”€ ngx_http_limit_req_module    (è¯·æ±‚é™æµ)
â”‚   â”œâ”€â”€ ngx_http_limit_conn_module   (è¿æ¥é™åˆ¶)
â”‚   â”œâ”€â”€ ngx_http_auth_basic_module   (åŸºæœ¬è®¤è¯)
â”‚   â”œâ”€â”€ ngx_http_rewrite_module      (URL é‡å†™)
â”‚   â””â”€â”€ ngx_http_log_module          (è®¿é—®æ—¥å¿—)
â”‚
â””â”€â”€ å¯é€‰æ¨¡å— (éœ€ç¼–è¯‘æ—¶å¯ç”¨)
    â”œâ”€â”€ ngx_http_stub_status_module      (çŠ¶æ€ç›‘æ§)
    â”œâ”€â”€ ngx_http_sub_module              (å†…å®¹æ›¿æ¢)
    â”œâ”€â”€ ngx_http_dav_module              (WebDAV)
    â”œâ”€â”€ ngx_http_geoip_module            (GeoIP)
    â”œâ”€â”€ ngx_http_lua_module              (Lua è„šæœ¬) â˜…
    â””â”€â”€ ngx_http_cache_purge_module      (ç¼“å­˜æ¸…é™¤) â˜…

ã€é‚®ä»¶ä»£ç†æ¨¡å— Mail Modulesã€‘
â”œâ”€â”€ ngx_mail_core_module
â”œâ”€â”€ ngx_mail_smtp_module
â”œâ”€â”€ ngx_mail_pop3_module
â”œâ”€â”€ ngx_mail_imap_module
â””â”€â”€ ngx_mail_ssl_module

ã€TCP/UDPä»£ç†æ¨¡å— Stream Modulesã€‘
â”œâ”€â”€ ngx_stream_core_module
â”œâ”€â”€ ngx_stream_proxy_module
â”œâ”€â”€ ngx_stream_ssl_module
â””â”€â”€ ngx_stream_upstream_module

â˜… ç¬¬ä¸‰æ–¹æ¨¡å—
</pre>
                </div>

                <h3 class="section-subtitle">æ¨¡å—ç±»å‹ä¸å¤„ç†é˜¶æ®µ</h3>
                <table class="info-table">
                    <thead>
                        <tr>
                            <th>æ¨¡å—ç±»å‹</th>
                            <th>å¤„ç†é˜¶æ®µ</th>
                            <th>å…¸å‹æ¨¡å—</th>
                            <th>æŒ‡ä»¤ç¤ºä¾‹</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>é…ç½®æ¨¡å—</td>
                            <td>å¯åŠ¨æ—¶</td>
                            <td>ngx_core_module</td>
                            <td><code>worker_processes</code></td>
                        </tr>
                        <tr>
                            <td>äº‹ä»¶æ¨¡å—</td>
                            <td>è¿è¡Œæ—¶</td>
                            <td>ngx_event_core_module</td>
                            <td><code>worker_connections</code></td>
                        </tr>
                        <tr>
                            <td>å¤„ç†é˜¶æ®µæ¨¡å—</td>
                            <td>è¯·æ±‚å¤„ç†</td>
                            <td>ngx_http_access_module</td>
                            <td><code>allow</code>, <code>deny</code></td>
                        </tr>
                        <tr>
                            <td>å†…å®¹ç”Ÿæˆæ¨¡å—</td>
                            <td>CONTENT é˜¶æ®µ</td>
                            <td>ngx_http_proxy_module</td>
                            <td><code>proxy_pass</code></td>
                        </tr>
                        <tr>
                            <td>è¿‡æ»¤å™¨æ¨¡å—</td>
                            <td>å“åº”è¾“å‡º</td>
                            <td>ngx_http_gzip_module</td>
                            <td><code>gzip</code></td>
                        </tr>
                        <tr>
                            <td>è´Ÿè½½å‡è¡¡æ¨¡å—</td>
                            <td>ä¸Šæ¸¸é€‰æ‹©</td>
                            <td>ngx_http_upstream_module</td>
                            <td><code>upstream</code></td>
                        </tr>
                    </tbody>
                </table>

                <div class="note-box">
                    <strong>ğŸ“¦ æ¨¡å—æŸ¥çœ‹æ–¹æ³•ï¼š</strong>
                    <pre>
# æŸ¥çœ‹å·²ç¼–è¯‘çš„æ¨¡å—
nginx -V

# è¾“å‡ºç¤ºä¾‹
nginx version: nginx/1.24.0
built by gcc ...
configure arguments: --with-http_ssl_module --with-http_v2_module ...</pre>
                </div>
            </div>
        </section>

        <section class="section">
            <div class="container">
                <h2 class="section-title">âš¡ é«˜æ€§èƒ½è®¾è®¡åŸç†</h2>
                
                <h3 class="section-subtitle">å¤šè¿›ç¨‹ vs å¤šçº¿ç¨‹æ¨¡å‹å¯¹æ¯”</h3>
                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th>ç‰¹æ€§</th>
                            <th>Nginx (å¤šè¿›ç¨‹)</th>
                            <th>ä¼ ç»ŸæœåŠ¡å™¨ (å¤šçº¿ç¨‹)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>è¿›ç¨‹/çº¿ç¨‹å…³ç³»</td>
                            <td>Worker è¿›ç¨‹ç›¸äº’ç‹¬ç«‹</td>
                            <td>çº¿ç¨‹å…±äº«è¿›ç¨‹èµ„æº</td>
                        </tr>
                        <tr>
                            <td>é”ç«äº‰</td>
                            <td>æ— éœ€é”ï¼ˆæ— å…±äº«çŠ¶æ€ï¼‰</td>
                            <td>éœ€è¦äº’æ–¥é”ä¿æŠ¤å…±äº«èµ„æº</td>
                        </tr>
                        <tr>
                            <td>æ•…éšœéš”ç¦»</td>
                            <td>å•ä¸ª Worker å´©æºƒä¸å½±å“å…¶ä»–</td>
                            <td>çº¿ç¨‹å´©æºƒå¯èƒ½å¯¼è‡´æ•´ä¸ªè¿›ç¨‹å´©æºƒ</td>
                        </tr>
                        <tr>
                            <td>å†…å­˜ä½¿ç”¨</td>
                            <td>è¿›ç¨‹é—´å†…å­˜ç‹¬ç«‹</td>
                            <td>çº¿ç¨‹å…±äº«å†…å­˜ç©ºé—´</td>
                        </tr>
                        <tr>
                            <td>æ‰©å±•æ€§</td>
                            <td>å¤šæ ¸ CPU å‹å¥½</td>
                            <td>å— GIL ç­‰é™åˆ¶</td>
                        </tr>
                        <tr>
                            <td>è°ƒè¯•éš¾åº¦</td>
                            <td>ç›¸å¯¹ç®€å•</td>
                            <td>æ­»é”ã€ç«æ€æ¡ä»¶å¤æ‚</td>
                        </tr>
                    </tbody>
                </table>

                <h3 class="section-subtitle">å†…å­˜æ± è®¾è®¡</h3>
                <div class="memory-layout">
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Nginx å†…å­˜æ± ç»“æ„                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ngx_pool_t (å†…å­˜æ± å¤´)                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ d = ngx_pool_data_t                                 â”‚   â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚   â”‚ å·²åˆ†é…å†…å­˜å— 1 (ngx_pool_large_t)           â”‚   â”‚   â”‚
â”‚  â”‚   â”‚   - å¤§å†…å­˜åˆ†é…ï¼ˆ> 4KBï¼‰é“¾è¡¨                  â”‚   â”‚   â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚   â”‚ å·²åˆ†é…å†…å­˜å— 2                               â”‚   â”‚   â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â”‚                                                     â”‚   â”‚
â”‚  â”‚   current â”€â”€> å½“å‰å°å—åˆ†é…ä½ç½®                      â”‚   â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚   â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘   â”‚   â”‚   â”‚
â”‚  â”‚   â”‚ å·²ä½¿ç”¨    ç©ºé—²ç©ºé—´                          â”‚   â”‚   â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â”‚                                                     â”‚   â”‚
â”‚  â”‚ max = 4096 bytes (å•æ¬¡åˆ†é…ä¸Šé™)                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â”‚ cleanup â”€â”€> æ¸…ç†å›è°ƒå‡½æ•°é“¾è¡¨                                â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚ cleanup handler: close_file                         â”‚  â”‚
â”‚   â”‚ cleanup handler: free_memory                        â”‚  â”‚
â”‚   â”‚ cleanup handler: destroy_temp_file                  â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å†…å­˜åˆ†é…ç­–ç•¥:
â”œâ”€â”€ å°å†…å­˜ (â‰¤ 4KB): ä» pool->d.current åˆ†é…ï¼ŒæŒ‡é’ˆç§»åŠ¨
â””â”€â”€ å¤§å†…å­˜ (> 4KB): å•ç‹¬åˆ†é…ï¼ŒåŠ å…¥ large é“¾è¡¨
                </div>

                <h3 class="section-subtitle">é›¶æ‹·è´æŠ€æœ¯</h3>
                <table class="info-table">
                    <thead>
                        <tr>
                            <th>æŠ€æœ¯</th>
                            <th>ç³»ç»Ÿè°ƒç”¨</th>
                            <th>æ•°æ®æ‹·è´æ¬¡æ•°</th>
                            <th>è¯´æ˜</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>ä¼ ç»Ÿ I/O</strong></td>
                            <td>read + write</td>
                            <td>4 æ¬¡æ‹·è´</td>
                            <td>ç£ç›˜â†’å†…æ ¸â†’ç”¨æˆ·â†’å†…æ ¸â†’ç½‘å¡</td>
                        </tr>
                        <tr>
                            <td><strong>mmap</strong></td>
                            <td>mmap + write</td>
                            <td>3 æ¬¡æ‹·è´</td>
                            <td>å†…å­˜æ˜ å°„å‡å°‘ä¸€æ¬¡æ‹·è´</td>
                        </tr>
                        <tr>
                            <td><strong>sendfile</strong></td>
                            <td>sendfile</td>
                            <td>2 æ¬¡æ‹·è´</td>
                            <td>å†…æ ¸æ€ç›´æ¥ä¼ è¾“</td>
                        </tr>
                        <tr>
                            <td><strong>sendfile + TCP_CORK</strong></td>
                            <td>sendfile + setsockopt</td>
                            <td>2 æ¬¡æ‹·è´</td>
                            <td>å»¶è¿Ÿå‘é€ï¼Œåˆå¹¶å°åŒ…</td>
                        </tr>
                    </tbody>
                </table>

                <div class="highlight-box">
                    <strong>ğŸ’¡ é›¶æ‹·è´é…ç½®ï¼š</strong>
                    <pre>
http {
    # å¯ç”¨ sendfile é›¶æ‹·è´
    sendfile on;
    
    # å¯ç”¨ tcp_nopushï¼Œé…åˆ sendfile ä½¿ç”¨
    tcp_nopush on;
    
    # å¯ç”¨ tcp_nodelayï¼Œç¦ç”¨ Nagle ç®—æ³•
    tcp_nodelay on;
    
    # sendfile å•æ¬¡æœ€å¤§ä¼ è¾“é‡
    sendfile_max_chunk 2m;
}</pre>
                </div>
            </div>
        </section>

        <section class="section">
            <div class="container">
                <h2 class="section-title">ğŸ”— è¿æ¥å¤„ç†æœºåˆ¶</h2>
                
                <div class="sequence-diagram">
                    <pre>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Client â”‚     â”‚  Listen  â”‚     â”‚ Worker  â”‚     â”‚  Free   â”‚
â”‚         â”‚     â”‚  Socket  â”‚     â”‚  Pool   â”‚     â”‚  List   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚                â”‚                â”‚                â”‚
     â”‚ SYN            â”‚                â”‚                â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚                â”‚
     â”‚                â”‚                â”‚                â”‚
     â”‚ SYN-ACK        â”‚                â”‚                â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                â”‚                â”‚
     â”‚                â”‚                â”‚                â”‚
     â”‚ ACK            â”‚                â”‚                â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚                â”‚
     â”‚                â”‚                â”‚                â”‚
     â”‚                â”‚ accept()       â”‚                â”‚
     â”‚                â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚
     â”‚                â”‚                â”‚                â”‚
     â”‚                â”‚                â”‚ ä»ç©ºé—²é“¾è¡¨è·å– â”‚
     â”‚                â”‚                â”‚ ngx_connection â”‚
     â”‚                â”‚                â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚                â”‚                â”‚                â”‚
     â”‚                â”‚                â”‚ åˆå§‹åŒ–è¿æ¥     â”‚
     â”‚                â”‚                â”‚ - è®¾ç½®å›è°ƒ     â”‚
     â”‚                â”‚                â”‚ - æ³¨å†Œè¯»äº‹ä»¶   â”‚
     â”‚                â”‚                â”‚                â”‚
     â”‚ HTTP Request   â”‚                â”‚                â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚                â”‚
     â”‚                â”‚                â”‚                â”‚
     â”‚                â”‚ è¯»äº‹ä»¶è§¦å‘     â”‚                â”‚
     â”‚                â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚
     â”‚                â”‚                â”‚                â”‚
     â”‚                â”‚                â”‚ è¯»å–å¹¶è§£æè¯·æ±‚ â”‚
     â”‚                â”‚                â”‚                â”‚
     â”‚                â”‚                â”‚ å¤„ç†è¯·æ±‚       â”‚
     â”‚                â”‚                â”‚                â”‚
     â”‚ HTTP Response  â”‚                â”‚                â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                â”‚                â”‚
     â”‚                â”‚                â”‚                â”‚
     â”‚                â”‚                â”‚ è¿æ¥å›æ”¶       â”‚
     â”‚                â”‚                â”‚ (keepalive)    â”‚
     â”‚                â”‚                â”‚                â”‚
                    </pre>
                </div>

                <h3 class="section-subtitle">è¿æ¥çŠ¶æ€æµè½¬</h3>
                <div class="flow-container">
                    <div class="flow-diagram">
                        <div class="flow-box">
                            <strong>FREE</strong>
                            <br><small>ç©ºé—²çŠ¶æ€</small>
                        </div>
                        <div class="flow-arrow">â†’</div>
                        <div class="flow-box">
                            <strong>ACCEPT</strong>
                            <br><small>æ¥å—è¿æ¥</small>
                        </div>
                        <div class="flow-arrow">â†’</div>
                        <div class="flow-box">
                            <strong>READ</strong>
                            <br><small>è¯»å–è¯·æ±‚</small>
                        </div>
                        <div class="flow-arrow">â†’</div>
                        <div class="flow-box">
                            <strong>PROCESS</strong>
                            <br><small>å¤„ç†è¯·æ±‚</small>
                        </div>
                        <div class="flow-arrow">â†’</div>
                        <div class="flow-box">
                            <strong>WRITE</strong>
                            <br><small>å†™å…¥å“åº”</small>
                        </div>
                        <div class="flow-arrow">â†’</div>
                        <div class="flow-box">
                            <strong>KEEPALIVE</strong>
                            <br><small>ä¿æŒè¿æ¥</small>
                        </div>
                        <div class="flow-arrow">â†º</div>
                        <div class="flow-box">
                            <strong>FREE</strong>
                            <br><small>å›æ”¶åˆ°ç©ºé—²é“¾è¡¨</small>
                        </div>
                    </div>
                </div>

                <h3 class="section-subtitle">è¿æ¥æ± é…ç½®</h3>
                <table class="info-table">
                    <thead>
                        <tr>
                            <th>æŒ‡ä»¤</th>
                            <th>é»˜è®¤å€¼</th>
                            <th>è¯´æ˜</th>
                            <th>è°ƒä¼˜å»ºè®®</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>worker_connections</code></td>
                            <td>1024</td>
                            <td>æ¯ä¸ª Worker æœ€å¤§è¿æ¥æ•°</td>
                            <td>æ ¹æ®å†…å­˜å’Œè´Ÿè½½è°ƒæ•´ï¼Œå»ºè®® 10240+</td>
                        </tr>
                        <tr>
                            <td><code>worker_rlimit_nofile</code></td>
                            <td>-</td>
                            <td>Worker æœ€å¤§æ–‡ä»¶æè¿°ç¬¦</td>
                            <td>åº” â‰¥ worker_connections Ã— 2</td>
                        </tr>
                        <tr>
                            <td><code>keepalive_timeout</code></td>
                            <td>75s</td>
                            <td>é•¿è¿æ¥è¶…æ—¶</td>
                            <td>æ ¹æ®ä¸šåŠ¡è°ƒæ•´ï¼ŒAPI å¯è®¾çŸ­äº›</td>
                        </tr>
                        <tr>
                            <td><code>keepalive_requests</code></td>
                            <td>100</td>
                            <td>é•¿è¿æ¥æœ€å¤§è¯·æ±‚æ•°</td>
                            <td>å»ºè®® 1000+ å‡å°‘æ¡æ‰‹</td>
                        </tr>
                        <tr>
                            <td><code>keepalive_time</code></td>
                            <td>âˆ</td>
                            <td>é•¿è¿æ¥æœ€å¤§ä½¿ç”¨æ—¶é—´</td>
                            <td>1.19.10+ æ–°å¢ï¼Œé˜²æ­¢è¿æ¥è€åŒ–</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <section class="section">
            <div class="container">
                <h2 class="section-title">ğŸ“Š é…ç½®åŠ è½½ä¸çƒ­æ›´æ–°</h2>
                
                <div class="flow-container">
                    <div class="flow-diagram">
                        <div class="flow-box master">
                            <strong>Master</strong>
                            <br><small>æ¥æ”¶ä¿¡å·</small>
                        </div>
                        <div class="flow-arrow">â†’</div>
                        <div class="flow-box module">
                            <strong>è¯»å–é…ç½®</strong>
                            <br><small>nginx.conf</small>
                        </div>
                        <div class="flow-arrow">â†’</div>
                        <div class="flow-box module">
                            <strong>éªŒè¯é…ç½®</strong>
                            <br><small>è¯­æ³•æ£€æŸ¥</small>
                        </div>
                        <div class="flow-arrow">â†’</div>
                        <div class="flow-box decision" style="border-radius: 50%; width: 80px; height: 80px; display: flex; align-items: center; justify-content: center;">
                            <strong>æˆåŠŸï¼Ÿ</strong>
                        </div>
                        <div class="flow-arrow">â†’</div>
                        <div class="flow-box worker">
                            <strong>é€šçŸ¥ Worker</strong>
                            <br><small>å‘é€ä¿¡å·</small>
                        </div>
                        <div class="flow-arrow">â†’</div>
                        <div class="flow-box worker">
                            <strong>Worker é‡å¯</strong>
                            <br><small>å¹³æ»‘è¿‡æ¸¡</small>
                        </div>
                    </div>
                </div>

                <h3 class="section-subtitle">ä¿¡å·å¤„ç†</h3>
                <table class="info-table">
                    <thead>
                        <tr>
                            <th>ä¿¡å·</th>
                            <th>å‘é€ç»™</th>
                            <th>ä½œç”¨</th>
                            <th>å‘½ä»¤ç¤ºä¾‹</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>HUP</code></td>
                            <td>Master</td>
                            <td>é‡æ–°åŠ è½½é…ç½®</td>
                            <td><code>nginx -s reload</code></td>
                        </tr>
                        <tr>
                            <td><code>USR1</code></td>
                            <td>Master</td>
                            <td>é‡æ–°æ‰“å¼€æ—¥å¿—æ–‡ä»¶ï¼ˆæ—¥å¿—è½®è½¬ï¼‰</td>
                            <td><code>kill -USR1 $(cat nginx.pid)</code></td>
                        </tr>
                        <tr>
                            <td><code>USR2</code></td>
                            <td>Master</td>
                            <td>çƒ­å‡çº§ï¼ˆå¯åŠ¨æ–° Masterï¼‰</td>
                            <td><code>kill -USR2 $(cat nginx.pid)</code></td>
                        </tr>
                        <tr>
                            <td><code>WINCH</code></td>
                            <td>Master</td>
                            <td>ä¼˜é›…å…³é—­ Workerï¼ˆå‡çº§åï¼‰</td>
                            <td><code>kill -WINCH $(cat nginx.pid.oldbin)</code></td>
                        </tr>
                        <tr>
                            <td><code>TERM</code></td>
                            <td>Master/Worker</td>
                            <td>å¿«é€Ÿå…³é—­</td>
                            <td><code>nginx -s stop</code></td>
                        </tr>
                        <tr>
                            <td><code>QUIT</code></td>
                            <td>Master/Worker</td>
                            <td>ä¼˜é›…å…³é—­ï¼ˆå®Œæˆå½“å‰è¯·æ±‚ï¼‰</td>
                            <td><code>nginx -s quit</code></td>
                        </tr>
                    </tbody>
                </table>

                <div class="highlight-box">
                    <strong>ğŸ”„ çƒ­å‡çº§æµç¨‹ï¼š</strong>
                    <pre>
# 1. å¤‡ä»½æ—§äºŒè¿›åˆ¶
sudo cp /usr/sbin/nginx /usr/sbin/nginx.old

# 2. æ›¿æ¢æ–°äºŒè¿›åˆ¶
sudo cp nginx-new /usr/sbin/nginx

# 3. å‘é€ USR2 ä¿¡å·ï¼Œå¯åŠ¨æ–° Master
sudo kill -USR2 $(cat /var/run/nginx.pid)

# 4. éªŒè¯æ–°ç‰ˆæœ¬
ps aux | grep nginx

# 5. ä¼˜é›…å…³é—­æ—§ Worker
sudo kill -WINCH $(cat /var/run/nginx.pid.oldbin)

# 6. ç¡®è®¤æ— è¯¯åå…³é—­æ—§ Master
sudo kill -QUIT $(cat /var/run/nginx.pid.oldbin)

# å¦‚éœ€å›æ»š
sudo kill -USR2 $(cat /var/run/nginx.pid)
sudo kill -WINCH $(cat /var/run/nginx.pid.oldbin)</pre>
                </div>
            </div>
        </section>

        <section class="section">
            <div class="container">
                <h2 class="section-title">ğŸ“ˆ æ€§èƒ½è°ƒä¼˜å‚æ•°</h2>
                
                <h3 class="section-subtitle">æ ¸å¿ƒå‚æ•°é…ç½®</h3>
                <table class="info-table">
                    <thead>
                        <tr>
                            <th>å‚æ•°ç±»åˆ«</th>
                            <th>æŒ‡ä»¤</th>
                            <th>æ¨èå€¼</th>
                            <th>è¯´æ˜</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td rowspan="3">è¿›ç¨‹é…ç½®</td>
                            <td><code>worker_processes</code></td>
                            <td><code>auto</code></td>
                            <td>è‡ªåŠ¨æ£€æµ‹ CPU æ ¸å¿ƒæ•°</td>
                        </tr>
                        <tr>
                            <td><code>worker_rlimit_nofile</code></td>
                            <td>65535</td>
                            <td>æœ€å¤§æ–‡ä»¶æ‰“å¼€æ•°</td>
                        </tr>
                        <tr>
                            <td><code>worker_connections</code></td>
                            <td>10240-65535</td>
                            <td>æ¯ Worker è¿æ¥æ•°</td>
                        </tr>
                        <tr>
                            <td rowspan="4">ç½‘ç»œä¼˜åŒ–</td>
                            <td><code>sendfile</code></td>
                            <td><code>on</code></td>
                            <td>å¯ç”¨é›¶æ‹·è´</td>
                        </tr>
                        <tr>
                            <td><code>tcp_nopush</code></td>
                            <td><code>on</code></td>
                            <td>TCP åŒ…ä¼˜åŒ–</td>
                        </tr>
                        <tr>
                            <td><code>tcp_nodelay</code></td>
                            <td><code>on</code></td>
                            <td>ç¦ç”¨ Nagle ç®—æ³•</td>
                        </tr>
                        <tr>
                            <td><code>keepalive_timeout</code></td>
                            <td>65s</td>
                            <td>é•¿è¿æ¥è¶…æ—¶</td>
                        </tr>
                        <tr>
                            <td rowspan="3">ç¼“å­˜ä¼˜åŒ–</td>
                            <td><code>open_file_cache</code></td>
                            <td><code>max=10000 inactive=20s</code></td>
                            <td>æ–‡ä»¶ç¼“å­˜</td>
                        </tr>
                        <tr>
                            <td><code>open_file_cache_valid</code></td>
                            <td>60s</td>
                            <td>ç¼“å­˜æ£€æŸ¥é—´éš”</td>
                        </tr>
                        <tr>
                            <td><code>open_file_cache_min_uses</code></td>
                            <td>2</td>
                            <td>æœ€å°ä½¿ç”¨æ¬¡æ•°</td>
                        </tr>
                        <tr>
                            <td rowspan="2">ç¼“å†²ä¼˜åŒ–</td>
                            <td><code>client_body_buffer_size</code></td>
                            <td>16k-128k</td>
                            <td>è¯·æ±‚ä½“ç¼“å†²</td>
                        </tr>
                        <tr>
                            <td><code>proxy_buffer_size</code></td>
                            <td>8k-16k</td>
                            <td>ä»£ç†å“åº”å¤´ç¼“å†²</td>
                        </tr>
                    </tbody>
                </table>

                <div class="note-box">
                    <strong>ğŸ’¡ å®Œæ•´ä¼˜åŒ–é…ç½®ç¤ºä¾‹ï¼š</strong>
                    <pre>
# è¿›ç¨‹é…ç½®
worker_processes auto;
worker_rlimit_nofile 65535;

events {
    use epoll;
    worker_connections 65535;
    multi_accept on;
    accept_mutex off;
}

http {
    # åŸºç¡€ä¼˜åŒ–
    sendfile on;
    tcp_nopush on;
    tcp_nodelay on;
    
    # è¿æ¥ä¼˜åŒ–
    keepalive_timeout 65;
    keepalive_requests 1000;
    keepalive_time 1h;
    
    # æ–‡ä»¶ç¼“å­˜
    open_file_cache max=10000 inactive=20s;
    open_file_cache_valid 60s;
    open_file_cache_min_uses 2;
    
    # ç¼“å†²é…ç½®
    client_body_buffer_size 128k;
    client_max_body_size 100m;
    
    # ä»£ç†ç¼“å†²
    proxy_buffer_size 16k;
    proxy_buffers 8 32k;
    proxy_busy_buffers_size 64k;
}</pre>
                </div>
            </div>
        </section>
    </main>
</body>
</html>
