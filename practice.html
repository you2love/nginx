<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nginx å®æˆ˜ç¯‡</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header class="header">
        <div class="container">
            <div class="logo">
                <h1>Nginx</h1>
                <p class="tagline">AIæ—¶ä»£çš„é«˜æ€§èƒ½WebæœåŠ¡å™¨</p>
            </div>
            <nav class="nav">
                <a href="index.html" class="nav-link">é¦–é¡µ</a>
                <a href="commands.html" class="nav-link">æŒ‡ä»¤ä¸é…ç½®</a>
                <a href="ai-tools.html" class="nav-link ai-highlight">AIå·¥å…·</a>
                <a href="practice.html" class="nav-link active">å®æˆ˜ç¯‡</a>
                <a href="resources.html" class="nav-link">å­¦ä¹ èµ„æº</a>
            </nav>
        </div>
    </header>

    <main>
        <section class="section">
            <div class="container">
                <h2 class="section-title">å®æˆ˜ç¯‡ - æœ€ä½³å®è·µ</h2>
                <div class="content-grid">
                    <div class="content-card">
                        <h3>ğŸ—ï¸ å¾®æœåŠ¡æ¶æ„</h3>
                        <ul>
                            <li>æœåŠ¡å‘ç°é›†æˆ</li>
                            <li>APIç½‘å…³é…ç½®</li>
                            <li>æœåŠ¡é—´é€šä¿¡ä¼˜åŒ–</li>
                            <li>ç†”æ–­ä¸é™çº§ç­–ç•¥</li>
                        </ul>
                    </div>
                    <div class="content-card">
                        <h3>ğŸ“± ç§»åŠ¨åº”ç”¨åç«¯</h3>
                        <ul>
                            <li>RESTful APIè®¾è®¡</li>
                            <li>WebSocketå®æ—¶é€šä¿¡</li>
                            <li>æ¨é€æœåŠ¡é…ç½®</li>
                            <li>ç§»åŠ¨ç«¯ä¼˜åŒ–ç­–ç•¥</li>
                        </ul>
                    </div>
                    <div class="content-card">
                        <h3>ğŸ¥ åª’ä½“æµæœåŠ¡</h3>
                        <ul>
                            <li>è§†é¢‘æµé…ç½®</li>
                            <li>ç›´æ’­æ¨æ‹‰æµè®¾ç½®</li>
                            <li>HLS/DASHåè®®æ”¯æŒ</li>
                            <li>è½¬ç ä¸åˆ†å‘ä¼˜åŒ–</li>
                        </ul>
                    </div>
                    <div class="content-card">
                        <h3>ğŸŒ å…¨çƒéƒ¨ç½²</h3>
                        <ul>
                            <li>å¤šåœ°åŸŸæ¶æ„è®¾è®¡</li>
                            <li>GeoDNSé…ç½®</li>
                            <li>è·¨åŒºåŸŸè´Ÿè½½å‡è¡¡</li>
                            <li>è¾¹ç¼˜è®¡ç®—é›†æˆ</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <section class="section bg-light">
            <div class="container">
                <h2 class="section-title">ğŸ“š å®æˆ˜æ¡ˆä¾‹</h2>
                <div class="case-grid">
                    <div class="case-item">
                        <h4>ç”µå•†ç½‘ç«™é«˜å¹¶å‘</h4>
                        <pre><code># ç”µå•†ç½‘ç«™é«˜å¹¶å‘é…ç½®
user nginx;
worker_processes auto;
worker_rlimit_nofile 100000;

events {
    worker_connections 100000;
    use epoll;
    multi_accept on;
}

http {
    # é™æ€èµ„æºæœåŠ¡å™¨é›†ç¾¤
    upstream static_servers {
        least_conn;
        server 10.0.1.10:80 weight=3;
        server 10.0.1.11:80 weight=3;
        keepalive 64;
    }

    # å•†å“APIæœåŠ¡å™¨é›†ç¾¤
    upstream product_api {
        ip_hash;
        server 10.0.2.10:3000 max_fails=3 fail_timeout=30s;
        server 10.0.2.11:3000 max_fails=3 fail_timeout=30s;
        keepalive 32;
    }

    # é™æµé…ç½®
    limit_req_zone $binary_remote_addr zone=api_limit:100m rate=100r/s;

    server {
        listen 443 ssl http2;
        server_name shop.example.com;

        # å•†å“æœç´¢æ¥å£
        location /api/products/search {
            limit_req zone=api_limit burst=100 nodelay;
            proxy_pass http://product_api;
            proxy_cache search_cache;
            proxy_cache_valid 200 10m;
        }
    }
}</code></pre>
                    </div>
                    <div class="case-item">
                        <h4>AIæœåŠ¡ç½‘å…³</h4>
                        <pre><code># AIæœåŠ¡ç½‘å…³é…ç½®
upstream ai_model_servers {
    server 10.0.1.10:8000 weight=5;
    server 10.0.1.11:8000 weight=5;
    keepalive 64;
}

server {
    listen 443 ssl http2;
    server_name ai-gateway.example.com;

    # æ–‡æœ¬ç”ŸæˆAPI
    location /api/text/generate {
        limit_req zone=text_api burst=10 nodelay;
        proxy_pass http://ai_model_servers;
        proxy_read_timeout 30s;
    }

    # å›¾åƒç”ŸæˆAPI
    location /api/image/generate {
        limit_req zone=image_api burst=3 nodelay;
        proxy_pass http://ai_model_servers;
        proxy_read_timeout 120s;
        client_max_body_size 10m;
    }
}</code></pre>
                    </div>
                    <div class="case-item">
                        <h4>å®æ—¶é€šè®¯å¹³å°</h4>
                        <pre><code># å®æ—¶é€šè®¯å¹³å° WebSocket é…ç½®
user nginx;
worker_processes auto;
worker_rlimit_nofile 1000000;

events {
    worker_connections 1000000;
    use epoll;
    multi_accept on;
}

http {
    # WebSocket æœåŠ¡å™¨é›†ç¾¤
    upstream websocket_backend {
        server 10.0.1.10:8080 weight=5 max_fails=3 fail_timeout=60s;
        server 10.0.1.11:8080 weight=5 max_fails=3 fail_timeout=60s;
        server 10.0.1.12:8080 weight=5 max_fails=3 fail_timeout=60s;
        server 10.0.1.13:8080 weight=5 max_fails=3 fail_timeout=60s;
        keepalive 1024;
    }

    # è¿æ¥æ•°é™æµï¼ˆæŒ‰ç”¨æˆ·ï¼‰
    limit_conn_zone $binary_remote_addr zone=ws_conn_limit:100m;

    # WebSocketå‡çº§åè®®æ˜ å°„
    map $http_upgrade $connection_upgrade {
        default upgrade;
        '' close;
    }

    # æ ¹æ®è¯·æ±‚è·¯å¾„è®¾ç½®ä¸åŒçš„è¶…æ—¶æ—¶é—´
    map $request_uri $ws_timeout {
        default 1d;
        ~^/chat 7d;
        ~^/video 1h;
    }

    server {
        listen 80;
        listen 443 ssl http2;
        server_name ws.example.com;

        # SSLé…ç½®
        ssl_certificate /etc/ssl/certs/ws.example.com.crt;
        ssl_certificate_key /etc/ssl/private/ws.example.com.key;
        ssl_protocols TLSv1.2 TLSv1.3;
        ssl_session_cache shared:SSL:100m;

        # å…¨å±€è¿æ¥æ•°é™åˆ¶
        limit_conn ws_conn_limit 10;

        # WebSocket è¿æ¥
        location /ws {
            proxy_pass http://websocket_backend;
            proxy_http_version 1.1;

            # WebSocket å‡çº§å¤´
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection $connection_upgrade;

            # ä¼ é€’å®¢æˆ·ç«¯ä¿¡æ¯
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;

            # è¶…æ—¶é…ç½®ï¼ˆWebSocketé•¿è¿æ¥ï¼‰
            proxy_connect_timeout 7d;
            proxy_send_timeout 7d;
            proxy_read_timeout 7d;

            # ç¦ç”¨ç¼“å†²
            proxy_buffering off;
            proxy_request_buffering off;

            # è¿æ¥ä¿æŒ
            proxy_socket_keepalive on;
        }

        # èŠå¤©å®¤ WebSocket
        location /chat {
            proxy_pass http://websocket_backend;
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection $connection_upgrade;
            proxy_set_header Host $host;

            # èŠå¤©å®¤è¶…æ—¶æ›´é•¿
            proxy_connect_timeout 7d;
            proxy_send_timeout 7d;
            proxy_read_timeout 7d;
            proxy_buffering off;
        }

        # è§†é¢‘é€šè¯ WebSocket
        location /video {
            proxy_pass http://websocket_backend;
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection $connection_upgrade;
            proxy_set_header Host $host;

            # è§†é¢‘é€šè¯è¶…æ—¶è¾ƒçŸ­
            proxy_connect_timeout 2h;
            proxy_send_timeout 2h;
            proxy_read_timeout 2h;
            proxy_buffering off;

            # æ”¯æŒæ›´å¤§çš„æ¶ˆæ¯ä½“
            client_max_body_size 100m;
        }

        # å¿ƒè·³æ£€æµ‹
        location /heartbeat {
            access_log off;
            return 200 "OK";
        }

        # WebSocket ç»Ÿè®¡ï¼ˆå†…éƒ¨ï¼‰
        location /internal/ws-stats {
            internal;
            stub_status;
            access_log off;
        }
    }

    # ç®¡ç†ç›‘æ§æœåŠ¡å™¨
    server {
        listen 8080;
        server_name ws-monitor.example.com;
        allow 192.168.1.0/24;
        deny all;

        location /stats {
            stub_status;
            access_log /var/log/nginx/ws_stats.log;
        }

        location /metrics {
            # Prometheus æŒ‡æ ‡è¾“å‡º
            access_log off;
            return 200 'nginx_ws_connections_total\nnginx_ws_active_connections\n';
        }
    }
}</code></pre>
                    </div>
                </div>
            </div>
        </section>

        <section class="section">
            <div class="container">
                <h2 class="section-title">ğŸ¯ æœ€ä½³å®è·µé…ç½®</h2>

                <div class="practice-item">
                    <h4>1. é«˜å¹¶å‘ä¼˜åŒ–é…ç½®</h4>
                    <pre><code>user nginx;
worker_processes auto;
worker_rlimit_nofile 65535;

events {
    worker_connections 65535;
    use epoll;
    multi_accept on;
}

http {
    keepalive_timeout 30;
    keepalive_requests 1000;
    client_body_buffer_size 128k;
    client_max_body_size 10m;
    open_file_cache max=65535 inactive=20s;
}</code></pre>
                </div>

                <div class="practice-item">
                    <h4>2. SSL/TLSæœ€ä½³å®è·µ</h4>
                    <pre><code>server {
    listen 443 ssl http2;
    server_name example.com;

    ssl_certificate /etc/letsencrypt/live/example.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/example.com/privkey.pem;
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers 'ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256';
    ssl_session_cache shared:SSL:10m;
    ssl_stapling on;

    add_header Strict-Transport-Security "max-age=63072000" always;
    add_header X-Frame-Options "SAMEORIGIN" always;
}</code></pre>
                </div>

                <div class="practice-item">
                    <h4>3. é™æµä¸é˜²æŠ¤é…ç½®</h4>
                    <pre><code>limit_req_zone $binary_remote_addr zone=api_limit:10m rate=10r/s;

server {
    location /api {
        limit_req zone=api_limit burst=20 nodelay;
        limit_req_status 429;
        proxy_pass http://backend;
    }

    allow 192.168.1.0/24;
    deny all;
}</code></pre>
                </div>
            </div>
        </section>
    </main>

    <footer class="footer">
        <div class="container">
            <p>Nginxæ•™ç¨‹ - AIæ—¶ä»£çš„é«˜æ€§èƒ½WebæœåŠ¡å™¨</p>
        </div>
    </footer>
</body>
</html>