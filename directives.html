<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nginx 指令详解 - 核心配置指南</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header class="header">
        <div class="container">
            <div class="logo">
                <h1>Nginx 深度学习</h1>
                <p class="tagline">揭秘内部机制，掌握核心配置</p>
            </div>
            <nav class="nav">
                <a href="index.html" class="nav-link">首页</a>
                <a href="mechanism.html" class="nav-link">内部机制</a>
                <a href="request-flow.html" class="nav-link">请求处理</a>
                <a href="directives.html" class="nav-link active">指令详解</a>
                <a href="configs.html" class="nav-link">应用配置</a>
            </nav>
        </div>
    </header>

    <main>
        <section class="section">
            <div class="container">
                <h1 class="page-title">Nginx 指令详解</h1>
                <p class="page-intro">全面掌握Nginx核心指令及其使用场景</p>
            </div>
        </section>


        <section class="section">
            <div class="container">
                <h2 class="section-title">最常用指令详解</h2>
                
                <h3 class="section-subtitle">核心配置指令</h3>
                <table class="info-table">
                    <thead>
                        <tr><th>指令</th><th>默认值</th><th>作用域</th><th>说明</th></tr>
                    </thead>
                    <tbody>
                        <tr><td><code>worker_processes</code></td><td>1</td><td>main</td><td>Worker进程数量，通常设为CPU核心数</td></tr>
                        <tr><td><code>worker_connections</code></td><td>1024</td><td>events</td><td>每个Worker的最大连接数</td></tr>
                        <tr><td><code>daemon</code></td><td>on</td><td>main</td><td>是否以守护进程运行</td></tr>
                        <tr><td><code>error_log</code></td><td>logs/error.log</td><td>main, http, server, location</td><td>错误日志路径和级别</td></tr>
                        <tr><td><code>pid</code></td><td>logs/nginx.pid</td><td>main</td><td>主进程PID文件路径</td></tr>
                    </tbody>
                </table>

                <h3 class="section-subtitle">HTTP核心指令</h3>
                <table class="info-table">
                    <thead>
                        <tr><th>指令</th><th>默认值</th><th>作用域</th><th>说明</th></tr>
                    </thead>
                    <tbody>
                        <tr><td><code>server</code></td><td>-</td><td>http</td><td>定义虚拟服务器</td></tr>
                        <tr><td><code>location</code></td><td>-</td><td>server, location</td><td>匹配请求URI</td></tr>
                        <tr><td><code>listen</code><td>80</td><td>server</td><td>监听端口和地址</td></tr>
                        <tr><td><code>server_name</code><td>""</td><td>server</td><td>虚拟主机名</td></tr>
                        <tr><td><code>root</code></td><td>html</td><td>http, server, location</td><td>网站根目录</td></tr>
                        <tr><td><code>index</code><td>index.html</td><td>http, server, location</td><td>默认首页文件</td></tr>
                    </tbody>
                </table>

                <h3 class="section-subtitle">代理相关指令</h3>
                <table class="info-table">
                    <thead>
                        <tr><th>指令</th><th>默认值</th><th>作用域</th><th>说明</th></tr>
                    </thead>
                    <tbody>
                        <tr><td><code>proxy_pass</code></td><td>-</td><td>location, if in location</td><td>代理服务器地址</td></tr>
                        <tr><td><code>proxy_set_header</code></td><td>-</td><td>http, server, location</td><td>设置代理请求头</td></tr>
                        <tr><td><code>proxy_connect_timeout</code></td><td>60s</td><td>http, server, location</td><td>连接超时时间</td></tr>
                        <tr><td><code>proxy_read_timeout</code></td><td>60s</td><td>http, server, location</td><td>读取超时时间</td></tr>
                        <tr><td><code>proxy_send_timeout</code></td><td>60s</td><td>http, server, location</td><td>发送超时时间</td></tr>
                    </tbody>
                </table>

                <h3 class="section-subtitle">缓存指令</h3>
                <table class="info-table">
                    <thead>
                        <tr><th>指令</th><th>默认值</th><th>作用域</th><th>说明</th></tr>
                    </thead>
                    <tbody>
                        <tr><td><code>proxy_cache</code></td><td>off</td><td>http, server, location</td><td>启用代理缓存</td></tr>
                        <tr><td><code>proxy_cache_path</code></td><td>-</td><td>http</td><td>定义缓存路径和参数</td></tr>
                        <tr><td><code>proxy_cache_valid</code><td>-</td><td>http, server, location</td><td>缓存有效时间</td></tr>
                        <tr><td><code>expires</code><td>off</td><td>http, server, location</td><td>缓存过期时间</td></tr>
                    </tbody>
                </table>

                <h3 class="section-subtitle">负载均衡指令</h3>
                <table class="info-table">
                    <thead>
                        <tr><th>指令</th><th>默认值</th><th>作用域</th><th>说明</th></tr>
                    </thead>
                    <tbody>
                        <tr><td><code>upstream</code><td>-</td><td>http</td><td>定义后端服务器组</td></tr>
                        <tr><td><code>server</code><td>-</td><td>upstream</td><td>定义后端服务器</td></tr>
                        <tr><td><code>least_conn</code><td>-</td><td>upstream</td><td>最少连接策略</td></tr>
                        <tr><td><code>ip_hash</code><td>-</td><td>upstream</td><td>IP哈希策略</td></tr>
                    </tbody>
                </table>
            </div>
        </section>

        <section class="section">
            <div class="container">
                <h3 class="section-subtitle">SSL/TLS指令</h3>
                <table class="info-table">
                    <thead>
                        <tr><th>指令</th><th>默认值</th><th>作用域</th><th>说明</th></tr>
                    </thead>
                    <tbody>
                        <tr><td><code>ssl</code></td><td>off</td><td>http, server</td><td>启用SSL</td></tr>
                        <tr><td><code>ssl_certificate</code><td>-</td><td>http, server</td><td>证书文件路径</td></tr>
                        <tr><td><code>ssl_certificate_key</code><td>-</td><td>http, server</td><td>私钥文件路径</td></tr>
                        <tr><td><code>ssl_protocols</code><td>TLSv1 TLSv1.1 TLSv1.2 TLSv1.3</td><td>http, server</td><td>支持的SSL协议</td></tr>
                    </tbody>
                </table>

                <h3 class="section-subtitle">访问控制指令</h3>
                <table class="info-table">
                    <thead>
                        <tr><th>指令</th><th>默认值</th><th>作用域</th><th>说明</th></tr>
                    </thead>
                    <tbody>
                        <tr><td><code>allow</code></td><td>-</td><td>http, server, location</td><td>允许访问的IP</td></tr>
                        <tr><td><code>deny</code></td><td>-</td><td>http, server, location</td><td>拒绝访问的IP</td></tr>
                        <tr><td><code>auth_basic</code></td><td>off</td><td>http, server, location</td><td>启用基本认证</td></tr>
                    </tbody>
                </table>

                <h3 class="section-subtitle">性能优化指令</h3>
                <table class="info-table">
                    <thead>
                        <tr><th>指令</th><th>默认值</th><th>作用域</th><th>说明</th></tr>
                    </thead>
                    <tbody>
                        <tr><td><code>sendfile</code></td><td>on</td><td>http, server, location</td><td>启用零拷贝传输</td></tr>
                        <tr><td><code>tcp_nopush</code></td><td>on</td><td>http, server, location</td><td>优化TCP包发送</td></tr>
                        <tr><td><code>gzip</code></td><td>off</td><td>http, server, location</td><td>启用gzip压缩</td></tr>
                        <tr><td><code>gzip_comp_level</code></td><td>1</td><td>http, server, location</td><td>压缩级别(1-9)</td></tr>
                        <tr><td><code>keepalive_timeout</code></td><td>75s</td><td>http, server, location</td><td>长连接超时</td></tr>
                    </tbody>
                </table>

                <h3 class="section-subtitle">连接限制指令</h3>
                <table class="info-table">
                    <thead>
                        <tr><th>指令</th><th>默认值</th><th>作用域</th><th>说明</th></tr>
                    </thead>
                    <tbody>
                        <tr><td><code>limit_conn</code></td><td>-</td><td>http, server, location</td><td>限制连接数</td></tr>
                        <tr><td><code>limit_req</code></td><td>-</td><td>http, server, location</td><td>限制请求速率</td></tr>
                        <tr><td><code>limit_conn_zone</code><td>-</td><td>http</td><td>定义连接限制空间</td></tr>
                        <tr><td><code>limit_req_zone</code><td>-</td><td>http</td><td>定义请求限制空间</td></tr>
                    </tbody>
                </table>

                <h3 class="section-subtitle">文件上传指令</h3>
                <table class="info-table">
                    <thead>
                        <tr><th>指令</th><th>默认值</th><th>作用域</th><th>说明</th></tr>
                    </thead>
                    <tbody>
                        <tr><td><code>client_max_body_size</code><td>1m</td><td>http, server, location</td><td>最大请求体大小</td></tr>
                        <tr><td><code>client_body_buffer_size</code><td>8k/16k</td><td>http, server, location</td><td>请求体缓冲区大小</td></tr>
                        <tr><td><code>client_body_timeout</code><td>60</td><td>http, server, location</td><td>请求体读取超时</td></tr>
                        <tr><td><code>client_header_timeout</code><td>60</td><td>http, server, location</td><td>请求头读取超时</td></tr>
                    </tbody>
                </table>

                <h3 class="section-subtitle">变量相关指令</h3>
                <table class="info-table">
                    <thead>
                        <tr><th>指令</th><th>默认值</th><th>作用域</th><th>说明</th></tr>
                    </thead>
                    <tbody>
                        <tr><td><code>set</code></td><td>-</td><td>server, location, if</td><td>定义变量</td></tr>
                        <tr><td><code>map</code></td><td>-</td><td>http</td><td>创建变量映射</td></tr>
                        <tr><td><code>geo</code></td><td>-</td><td>http</td><td>基于IP定义变量</td></tr>
                    </tbody>
                </table>

                <h3 class="section-subtitle">缓冲相关指令</h3>
                <table class="info-table">
                    <thead>
                        <tr><th>指令</th><th>默认值</th><th>作用域</th><th>说明</th></tr>
                    </thead>
                    <tbody>
                        <tr><td><code>proxy_buffering</code><td>on</td><td>http, server, location</td><td>启用代理缓冲</td></tr>
                        <tr><td><code>proxy_buffers</code><td>8 4k/8k</td><td>http, server, location</td><td>代理缓冲区数量和大小</td></tr>
                        <tr><td><code>proxy_buffer_size</code><td>4k/8k</td><td>http, server, location</td><td>代理缓冲区大小</td></tr>
                        <tr><td><code>fastcgi_buffering</code><td>on</td><td>http, server, location</td><td>启用FastCGI缓冲</td></tr>
                        <tr><td><code>fastcgi_buffers</code><td>8 4k/8k</td><td>http, server, location</td><td>FastCGI缓冲区</td></tr>
                    </tbody>
                </table>

                <h3 class="section-subtitle">重定向指令</h3>
                <table class="info-table">
                    <thead>
                        <tr><th>指令</th><th>默认值</th><th>作用域</th><th>说明</th></tr>
                    </thead>
                    <tbody>
                        <tr><td><code>redirect</code></td><td>-</td><td>location</td><td>302临时重定向</td></tr>
                        <tr><td><code>permanent</code></td><td>-</td><td>location</td><td>301永久重定向</td></tr>
                        <tr><td><code>rewrite</code></td><td>-</td><td>server, location</td><td>URL重写</td></tr>
                        <tr><td><code>error_page</code></td><td>-</td><td>http, server, location</td><td>自定义错误页面</td></tr>
                    </tbody>
                </table>
            </div>
        </section>
    </main>

</body>
</html>
        <section class="section bg-light">
            <div class="container">
                <h2 class="section-title">指令常用参数值</h2>
                
                <h3 class="section-subtitle">worker_processes 参数值</h3>
                <table class="info-table">
                    <thead>
                        <tr><th>值</th><th>说明</th></tr>
                    </thead>
                    <tbody>
                        <tr><td><code>1</code></td><td>默认值，单进程模式</td></tr>
                        <tr><td><code>auto</code></td><td>自动检测CPU核心数</td></tr>
                        <tr><td><code>2, 4, 8...</code></td><td>指定进程数量</td></tr>
                    </tbody>
                </table>

                <h3 class="section-subtitle">error_log 级别值</h3>
                <table class="info-table">
                    <thead>
                        <tr><th>级别</th><th>说明</th></tr>
                    </thead>
                    <tbody>
                        <tr><td><code>debug</code></td><td>调试信息</td></tr>
                        <tr><td><code>info</code></td><td>信息消息</td></tr>
                        <tr><td><code>notice</code></td><td>通知消息</td></tr>
                        <tr><td><code>warn</code></td><td>警告消息</td></tr>
                        <tr><td><code>error</code></td><td>错误消息（默认）</td></tr>
                        <tr><td><code>crit</code></td><td>严重错误</td></tr>
                        <tr><td><code>alert</code></td><td>警报</td></tr>
                        <tr><td><code>emerg</code></td><td>紧急情况</td></tr>
                    </tbody>
                </table>

                <h3 class="section-subtitle">location 匹配优先级</h3>
                <table class="info-table">
                    <thead>
                        <tr><th>优先级</th><th>匹配规则</th><th>说明</th></tr>
                    </thead>
                    <tbody>
                        <tr><td>1</td><td><code>= /path</code></td><td>精确匹配，优先级最高</td></tr>
                        <tr><td>2</td><td><code>^~ /path</code></td><td>前缀匹配，停止正则搜索</td></tr>
                        <tr><td>3</td><td><code>~ pattern</code></td><td>正则匹配（区分大小写）</td></tr>
                        <tr><td>4</td><td><code>~* pattern</code></td><td>正则匹配（不区分大小写）</td></tr>
                        <tr><td>5</td><td><code>/path</code></td><td>前缀匹配，优先级最低</td></tr>
                    </tbody>
                </table>

                <h3 class="section-subtitle">proxy_set_header 常用值</h3>
                <table class="info-table">
                    <thead>
                        <tr><th>参数</th><th>说明</th></tr>
                    </thead>
                    <tbody>
                        <tr><td><code>Host $host</code></td><td>传递原始Host头</td></tr>
                        <tr><td><code>X-Real-IP $remote_addr</code></td><td>传递客户端真实IP</td></tr>
                        <tr><td><code>X-Forwarded-For $proxy_add_x_forwarded_for</code></td><td>传递代理链路</td></tr>
                        <tr><td><code>X-Forwarded-Proto $scheme</code></td><td>传递原始协议</td></tr>
                    </tbody>
                </table>

                <h3 class="section-subtitle">gzip 常用参数值</h3>
                <table class="info-table">
                    <thead>
                        <tr><th>参数</th><th>说明</th></tr>
                    </thead>
                    <tbody>
                        <tr><td><code>gzip_types text/plain text/css application/json</code></td><td>指定压缩类型</td></tr>
                        <tr><td><code>gzip_min_length 1000</code></td><td>最小压缩文件大小</td></tr>
                        <tr><td><code>gzip_disable "msie6"</code></td><td>禁用特定浏览器压缩</td></tr>
                        <tr><td><code>gzip_proxied any</code></td><td>对代理响应压缩</td></tr>
                    </tbody>
                </table>

                <h3 class="section-subtitle">upstream server 参数值</h3>
                <table class="info-table">
                    <thead>
                        <tr><th>参数</th><th>说明</th></tr>
                    </thead>
                    <tbody>
                        <tr><td><code>weight=3</code></td><td>权重值</td></tr>
                        <tr><td><code>max_fails=3</code></td><td>最大失败次数</td></tr>
                        <tr><td><code>fail_timeout=30s</code></td><td>失败超时时间</td></tr>
                        <tr><td><code>backup</code></td><td>备份服务器</td></tr>
                        <tr><td><code>down</code></td><td>标记服务器离线</td></tr>
                        <tr><td><code>max_conns=100</code></td><td>最大连接数</td></tr>
                    </tbody>
                </table>

                <h3 class="section-subtitle">常用变量</h3>
                <table class="info-table">
                    <thead>
                        <tr><th>变量</th><th>说明</th></tr>
                    </thead>
                    <tbody>
                        <tr><td><code>$remote_addr</code></td><td>客户端IP地址</td></tr>
                        <tr><td><code>$remote_user</code></td><td>客户端用户名</td></tr>
                        <tr><td><code>$request_uri</code></td><td>完整的请求URI</td></tr>
                        <tr><td><code>$request_method</code></td><td>请求方法</td></tr>
                        <tr><td><code>$http_user_agent</code></td><td>客户端User-Agent</td></tr>
                        <tr><td><code>$http_referer</code></td><td>来源页面</td></tr>
                        <tr><td><code>$scheme</code></td><td>请求协议(http/https)</td></tr>
                        <tr><td><code>$server_port</code></td><td>服务器端口</td></tr>
                        <tr><td><code>$host</code></td><td>请求主机名</td></tr>
                        <tr><td><code>$request_time</code></td><td>请求处理时间</td></tr>
                        <tr><td><code>$status</code></td><td>响应状态码</td></tr>
                        <tr><td><code>$body_bytes_sent</code></td><td>发送字节数</td></tr>
                        <tr><td><code>$upstream_addr</code></td><td>后端服务器地址</td></tr>
                        <tr><td><code>$upstream_status</code></td><td>后端响应状态</td></tr>
                    </tbody>
                </table>

                <h3 class="section-subtitle">SSL 常用配置</h3>
                <table class="info-table">
                    <thead>
                        <tr><th>参数</th><th>说明</th></tr>
                    </thead>
                    <tbody>
                        <tr><td><code>ssl_session_cache shared:SSL:10m</code></td><td>SSL会话缓存</td></tr>
                        <tr><td><code>ssl_session_timeout 1d</code></td><td>SSL会话超时</td></tr>
                        <tr><td><code>ssl_prefer_server_ciphers on</code></td><td>优先使用服务器加密套件</td></tr>
                        <tr><td><code>ssl_ciphers HIGH:!aNULL:!MD5</code></td><td>加密套件列表</td></tr>
                        <tr><td><code>ssl_stapling on</code></td><td>启用OCSP装订</td></tr>
                        <tr><td><code>ssl_stapling_verify on</code></td><td>验证OCSP响应</td></tr>
                    </tbody>
                </table>
            </div>
        </section>
    </main>

</body>
</html>
